<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.99.1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<link rel="preload" href="https://alamot.github.io/css/noncrit.css" as="style" onload="this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://alamot.github.io/css/noncrit.css"></noscript>
<style>
button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}
*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}:before,:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}
input,button,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}
.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}
[role="button"]{cursor: pointer;}
.container{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}@media (min-width: 768px){.container{width:750px}}@media (min-width: 992px){.container{width:970px}}@media (min-width: 1200px){.container{width:1170px}}.container-fluid{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}.row{margin-left:-15px;margin-right:-15px}
.col-xs-1, .col-sm-1, .col-md-1, .col-lg-1, .col-xs-2, .col-sm-2, .col-md-2, .col-lg-2, .col-xs-3, .col-sm-3, .col-md-3, .col-lg-3, .col-xs-4, .col-sm-4, .col-md-4, .col-lg-4, .col-xs-5, .col-sm-5, .col-md-5, .col-lg-5, .col-xs-6, .col-sm-6, .col-md-6, .col-lg-6, .col-xs-7, .col-sm-7, .col-md-7, .col-lg-7, .col-xs-8, .col-sm-8, .col-md-8, .col-lg-8, .col-xs-9, .col-sm-9, .col-md-9, .col-lg-9, .col-xs-10, .col-sm-10, .col-md-10, .col-lg-10, .col-xs-11, .col-sm-11, .col-md-11, .col-lg-11, .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 { position: relative; min-height: 1px; padding-left: 15px; padding-right: 15px; }
@media (min-width: 768px){.col-sm-1,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-10,.col-sm-11,.col-sm-12{float:left}.col-sm-12{width:100%}.col-sm-11{width:91.66666667%}.col-sm-10{width:83.33333333%}.col-sm-9{width:75%}.col-sm-8{width:66.66666667%}.col-sm-7{width:58.33333333%}.col-sm-6{width:50%}.col-sm-5{width:41.66666667%}.col-sm-4{width:33.33333333%}.col-sm-3{width:25%}.col-sm-2{width:16.66666667%}.col-sm-1{width:8.33333333%}.col-sm-pull-12{right:100%}.col-sm-pull-11{right:91.66666667%}.col-sm-pull-10{right:83.33333333%}.col-sm-pull-9{right:75%}.col-sm-pull-8{right:66.66666667%}.col-sm-pull-7{right:58.33333333%}.col-sm-pull-6{right:50%}.col-sm-pull-5{right:41.66666667%}.col-sm-pull-4{right:33.33333333%}.col-sm-pull-3{right:25%}.col-sm-pull-2{right:16.66666667%}.col-sm-pull-1{right:8.33333333%}.col-sm-pull-0{right:auto}.col-sm-push-12{left:100%}.col-sm-push-11{left:91.66666667%}.col-sm-push-10{left:83.33333333%}.col-sm-push-9{left:75%}.col-sm-push-8{left:66.66666667%}.col-sm-push-7{left:58.33333333%}.col-sm-push-6{left:50%}.col-sm-push-5{left:41.66666667%}.col-sm-push-4{left:33.33333333%}.col-sm-push-3{left:25%}.col-sm-push-2{left:16.66666667%}.col-sm-push-1{left:8.33333333%}.col-sm-push-0{left:auto}.col-sm-offset-12{margin-left:100%}.col-sm-offset-11{margin-left:91.66666667%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-0{margin-left:0}}@media (min-width: 992px){.col-md-1,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-10,.col-md-11,.col-md-12{float:left}.col-md-12{width:100%}.col-md-11{width:91.66666667%}.col-md-10{width:83.33333333%}.col-md-9{width:75%}.col-md-8{width:66.66666667%}.col-md-7{width:58.33333333%}.col-md-6{width:50%}.col-md-5{width:41.66666667%}.col-md-4{width:33.33333333%}.col-md-3{width:25%}.col-md-2{width:16.66666667%}.col-md-1{width:8.33333333%}.col-md-pull-12{right:100%}.col-md-pull-11{right:91.66666667%}.col-md-pull-10{right:83.33333333%}.col-md-pull-9{right:75%}.col-md-pull-8{right:66.66666667%}.col-md-pull-7{right:58.33333333%}.col-md-pull-6{right:50%}.col-md-pull-5{right:41.66666667%}.col-md-pull-4{right:33.33333333%}.col-md-pull-3{right:25%}.col-md-pull-2{right:16.66666667%}.col-md-pull-1{right:8.33333333%}.col-md-pull-0{right:auto}.col-md-push-12{left:100%}.col-md-push-11{left:91.66666667%}.col-md-push-10{left:83.33333333%}.col-md-push-9{left:75%}.col-md-push-8{left:66.66666667%}.col-md-push-7{left:58.33333333%}.col-md-push-6{left:50%}.col-md-push-5{left:41.66666667%}.col-md-push-4{left:33.33333333%}.col-md-push-3{left:25%}.col-md-push-2{left:16.66666667%}.col-md-push-1{left:8.33333333%}.col-md-push-0{left:auto}.col-md-offset-12{margin-left:100%}.col-md-offset-11{margin-left:91.66666667%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-9{margin-left:75%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-6{margin-left:50%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-3{margin-left:25%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-0{margin-left:0}}
label { display: inline-block; max-width: 100%; margin-bottom: 5px; font-weight: bold; }
.btn{display:inline-block;margin-bottom:0;font-weight:400;text-align:center;vertical-align:middle;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;padding:6px 12px;font-size:16px;line-height:1.4;border-radius:4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.btn:focus,.btn:active:focus,.btn.active:focus,.btn.focus,.btn:active.focus,.btn.active.focus{outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}.btn:hover,.btn:focus,.btn.focus{color:#333;text-decoration:none}.btn:active,.btn.active{outline:0;background-image:none;-webkit-box-shadow:inset 0 3px 5px rgba(0,0,0,0.125);box-shadow:inset 0 3px 5px rgba(0,0,0,0.125)}.btn.disabled,.btn[disabled],fieldset[disabled] .btn{cursor:not-allowed;opacity:.65;filter:alpha(opacity=65);-webkit-box-shadow:none;box-shadow:none}a.btn.disabled,fieldset[disabled] a.btn{pointer-events:none}.btn-default{color:#333;background-color:#fff;border-color:#ccc}.btn-default:focus,.btn-default.focus{color:#333;background-color:#e6e6e6;border-color:#8c8c8c}.btn-default:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default:active,.btn-default.active,.open > .dropdown-toggle.btn-default{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default:active:hover,.btn-default.active:hover,.open > .dropdown-toggle.btn-default:hover,.btn-default:active:focus,.btn-default.active:focus,.open > .dropdown-toggle.btn-default:focus,.btn-default:active.focus,.btn-default.active.focus,.open > .dropdown-toggle.btn-default.focus{color:#333;background-color:#d4d4d4;border-color:#8c8c8c}.btn-default:active,.btn-default.active,.open > .dropdown-toggle.btn-default{background-image:none}.btn-default.disabled:hover,.btn-default[disabled]:hover,fieldset[disabled] .btn-default:hover,.btn-default.disabled:focus,.btn-default[disabled]:focus,fieldset[disabled] .btn-default:focus,.btn-default.disabled.focus,.btn-default[disabled].focus,fieldset[disabled] .btn-default.focus{background-color:#fff;border-color:#ccc}.btn-default .badge{color:#fff;background-color:#333}.btn-primary{color:#fff;background-color:#195eff;border-color:#004cff}.btn-primary:focus,.btn-primary.focus{color:#fff;background-color:#0045e5;border-color:#00267f}.btn-primary:hover{color:#fff;background-color:#0045e5;border-color:#003ac1}.btn-primary:active,.btn-primary.active,.open > .dropdown-toggle.btn-primary{color:#fff;background-color:#0045e5;border-color:#003ac1}.btn-primary:active:hover,.btn-primary.active:hover,.open > .dropdown-toggle.btn-primary:hover,.btn-primary:active:focus,.btn-primary.active:focus,.open > .dropdown-toggle.btn-primary:focus,.btn-primary:active.focus,.btn-primary.active.focus,.open > .dropdown-toggle.btn-primary.focus{color:#fff;background-color:#003ac1;border-color:#00267f}.btn-primary:active,.btn-primary.active,.open > .dropdown-toggle.btn-primary{background-image:none}.btn-primary.disabled:hover,.btn-primary[disabled]:hover,fieldset[disabled] .btn-primary:hover,.btn-primary.disabled:focus,.btn-primary[disabled]:focus,fieldset[disabled] .btn-primary:focus,.btn-primary.disabled.focus,.btn-primary[disabled].focus,fieldset[disabled] .btn-primary.focus{background-color:#195eff;border-color:#004cff}.btn-primary .badge{color:#195eff;background-color:#fff}.btn-success{color:#fff;background-color:#00bc16;border-color:#00a313}.btn-success:focus,.btn-success.focus{color:#fff;background-color:#008910;border-color:#002304}.btn-success:hover{color:#fff;background-color:#008910;border-color:#00650c}.btn-success:active,.btn-success.active,.open > .dropdown-toggle.btn-success{color:#fff;background-color:#008910;border-color:#00650c}.btn-success:active:hover,.btn-success.active:hover,.open > .dropdown-toggle.btn-success:hover,.btn-success:active:focus,.btn-success.active:focus,.open > .dropdown-toggle.btn-success:focus,.btn-success:active.focus,.btn-success.active.focus,.open > .dropdown-toggle.btn-success.focus{color:#fff;background-color:#00650c;border-color:#002304}.btn-success:active,.btn-success.active,.open > .dropdown-toggle.btn-success{background-image:none}.btn-success.disabled:hover,.btn-success[disabled]:hover,fieldset[disabled] .btn-success:hover,.btn-success.disabled:focus,.btn-success[disabled]:focus,fieldset[disabled] .btn-success:focus,.btn-success.disabled.focus,.btn-success[disabled].focus,fieldset[disabled] .btn-success.focus{background-color:#00bc16;border-color:#00a313}.btn-success .badge{color:#00bc16;background-color:#fff}.btn-info{color:#fff;background-color:#5bc0de;border-color:#46b8da}.btn-info:focus,.btn-info.focus{color:#fff;background-color:#31b0d5;border-color:#1b6d85}.btn-info:hover{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info:active,.btn-info.active,.open > .dropdown-toggle.btn-info{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info:active:hover,.btn-info.active:hover,.open > .dropdown-toggle.btn-info:hover,.btn-info:active:focus,.btn-info.active:focus,.open > .dropdown-toggle.btn-info:focus,.btn-info:active.focus,.btn-info.active.focus,.open > .dropdown-toggle.btn-info.focus{color:#fff;background-color:#269abc;border-color:#1b6d85}.btn-info:active,.btn-info.active,.open > .dropdown-toggle.btn-info{background-image:none}.btn-info.disabled:hover,.btn-info[disabled]:hover,fieldset[disabled] .btn-info:hover,.btn-info.disabled:focus,.btn-info[disabled]:focus,fieldset[disabled] .btn-info:focus,.btn-info.disabled.focus,.btn-info[disabled].focus,fieldset[disabled] .btn-info.focus{background-color:#5bc0de;border-color:#46b8da}.btn-info .badge{color:#5bc0de;background-color:#fff}.btn-warning{color:#fff;background-color:#f0ad4e;border-color:#eea236}.btn-warning:focus,.btn-warning.focus{color:#fff;background-color:#ec971f;border-color:#985f0d}.btn-warning:hover{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning:active,.btn-warning.active,.open > .dropdown-toggle.btn-warning{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning:active:hover,.btn-warning.active:hover,.open > .dropdown-toggle.btn-warning:hover,.btn-warning:active:focus,.btn-warning.active:focus,.open > .dropdown-toggle.btn-warning:focus,.btn-warning:active.focus,.btn-warning.active.focus,.open > .dropdown-toggle.btn-warning.focus{color:#fff;background-color:#d58512;border-color:#985f0d}.btn-warning:active,.btn-warning.active,.open > .dropdown-toggle.btn-warning{background-image:none}.btn-warning.disabled:hover,.btn-warning[disabled]:hover,fieldset[disabled] .btn-warning:hover,.btn-warning.disabled:focus,.btn-warning[disabled]:focus,fieldset[disabled] .btn-warning:focus,.btn-warning.disabled.focus,.btn-warning[disabled].focus,fieldset[disabled] .btn-warning.focus{background-color:#f0ad4e;border-color:#eea236}.btn-warning .badge{color:#f0ad4e;background-color:#fff}.btn-danger{color:#fff;background-color:#d9534f;border-color:#d43f3a}.btn-danger:focus,.btn-danger.focus{color:#fff;background-color:#c9302c;border-color:#761c19}.btn-danger:hover{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger:active,.btn-danger.active,.open > .dropdown-toggle.btn-danger{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger:active:hover,.btn-danger.active:hover,.open > .dropdown-toggle.btn-danger:hover,.btn-danger:active:focus,.btn-danger.active:focus,.open > .dropdown-toggle.btn-danger:focus,.btn-danger:active.focus,.btn-danger.active.focus,.open > .dropdown-toggle.btn-danger.focus{color:#fff;background-color:#ac2925;border-color:#761c19}.btn-danger:active,.btn-danger.active,.open > .dropdown-toggle.btn-danger{background-image:none}.btn-danger.disabled:hover,.btn-danger[disabled]:hover,fieldset[disabled] .btn-danger:hover,.btn-danger.disabled:focus,.btn-danger[disabled]:focus,fieldset[disabled] .btn-danger:focus,.btn-danger.disabled.focus,.btn-danger[disabled].focus,fieldset[disabled] .btn-danger.focus{background-color:#d9534f;border-color:#d43f3a}.btn-danger .badge{color:#d9534f;background-color:#fff}.btn-link{color:#000;font-weight:400;border-radius:0}.btn-link,.btn-link:active,.btn-link.active,.btn-link[disabled],fieldset[disabled] .btn-link{background-color:transparent;-webkit-box-shadow:none;box-shadow:none}.btn-link,.btn-link:hover,.btn-link:focus,.btn-link:active{border-color:transparent}.btn-link:hover,.btn-link:focus{color:#000;text-decoration:none;background-color:transparent}.btn-link[disabled]:hover,fieldset[disabled] .btn-link:hover,.btn-link[disabled]:focus,fieldset[disabled] .btn-link:focus{color:#777;text-decoration:none}.btn-lg{padding:10px 16px;font-size:20px;line-height:1.3333333;border-radius:6px}.btn-sm{padding:5px 10px;font-size:14px;line-height:1.5;border-radius:3px}.btn-xs{padding:1px 5px;font-size:14px;line-height:1.5;border-radius:3px}.btn-block{display:block;width:100%}.btn-block + .btn-block{margin-top:5px}
.dropup,.dropdown{position:relative}.dropdown-toggle:focus{outline:0}.dropdown-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:160px;padding:5px 0;margin:2px 0 0;list-style:none;font-size:16px;text-align:left;background-color:#fff;border:1px solid #ccc;border:1px solid rgba(0,0,0,0.15);border-radius:4px;-webkit-box-shadow:0 6px 12px rgba(0,0,0,0.175);box-shadow:0 6px 12px rgba(0,0,0,0.175);-webkit-background-clip:padding-box;background-clip:padding-box}.dropdown-menu.pull-right{right:0;left:auto}.dropdown-menu .divider{height:1px;margin:10px 0;overflow:hidden;background-color:#e5e5e5}.dropdown-menu > li > a{display:block;padding:3px 10px;clear:both;font-weight:400;line-height:1.4;color:#333;white-space:nowrap}.dropdown-menu > li > a:hover,.dropdown-menu > li > a:focus{text-decoration:none;color:#262626;background-color:#f5f5f5}.dropdown-menu > .active > a,.dropdown-menu > .active > a:hover,.dropdown-menu > .active > a:focus{color:#fff;text-decoration:none;outline:0;background-color:#195eff}.dropdown-menu > .disabled > a,.dropdown-menu > .disabled > a:hover,.dropdown-menu > .disabled > a:focus{color:#777}.dropdown-menu > .disabled > a:hover,.dropdown-menu > .disabled > a:focus{text-decoration:none;background-color:transparent;background-image:none;filter:progid:DXImageTransform.Microsoft.gradient(enabled = false);cursor:not-allowed}.open > .dropdown-menu{display:block}.open > a{outline:0}.dropdown-menu-right{left:auto;right:0}.dropdown-menu-left{left:0;right:auto}.dropdown-header{display:block;padding:3px 10px;font-size:14px;line-height:1.4;color:#777;white-space:nowrap}.dropdown-backdrop{position:fixed;left:0;right:0;bottom:0;top:0;z-index:990}.pull-right > .dropdown-menu{right:0;left:auto}.dropup .caret,.navbar-fixed-bottom .dropdown .caret{border-top:0;border-bottom:4px dashed;border-bottom:4px solid \9;content:""}.dropup .dropdown-menu,.navbar-fixed-bottom .dropdown .dropdown-menu{top:auto;bottom:100%;margin-bottom:2px}
.nav{margin-bottom:0;padding-left:0;list-style:none}.nav > li{position:relative;display:block}.nav > li > a{position:relative;display:block;padding:5px 10px}.nav > li > a:hover,.nav > li > a:focus{text-decoration:none;background-color:#a52a2a}.nav > li.disabled > a{color:#777}.nav > li.disabled > a:hover,.nav > li.disabled > a:focus{color:#777;text-decoration:none;background-color:transparent;cursor:not-allowed}.nav .open > a,.nav .open > a:hover,.nav .open > a:focus{background-color:#a52a2a;border-color:#000}.nav .nav-divider{height:1px;margin:10px 0;overflow:hidden;background-color:#e5e5e5}.nav > li > a > img{max-width:none}.nav-pills > li{float:left}.nav-pills > li > a{border-radius:4px}.nav-pills > li + li{margin-left:2px}.nav-pills > li.active > a,.nav-pills > li.active > a:hover,.nav-pills > li.active > a:focus{color:#fff;background-color:#195eff}.nav-stacked > li{float:none}.nav-stacked > li + li{margin-top:0px;margin-left:0}.navbar{position:relative;min-height:48px;max-height:48px;margin-bottom:22px;border:1px solid transparent}@media (min-width: 768px){.navbar{border-radius:4px}}@media (max-device-width: 480px) and (orientation: landscape){.navbar-fixed-top .navbar-collapse,.navbar-fixed-bottom .navbar-collapse{max-height:200px}}.navbar-static-top{z-index:1000;border-width:0 0 1px}@media (min-width: 768px){.navbar-static-top{border-radius:0}}.navbar-fixed-top,.navbar-fixed-bottom{position:fixed;right:0;left:0;z-index:1030}@media (min-width: 768px){.navbar-fixed-top,.navbar-fixed-bottom{border-radius:0}}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-fixed-bottom{bottom:0;margin-bottom:0;border-width:1px 0 0}@media (min-width: 768px){.navbar > .container .navbar-brand,.navbar > .container-fluid .navbar-brand{margin-left:-15px}}.navbar-fixed-bottom .navbar-nav > li > .dropdown-menu{margin-bottom:0;border-top-right-radius:4px;border-top-left-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.navbar-default{background-color:#7d1935;border-color:#611329}.navbar-default .navbar-nav > li > a{color:#fff}.navbar-default .navbar-nav > li > a:hover,.navbar-default .navbar-nav > li > a:focus{color:#fff;background-color:#a52a2a}.navbar-default .navbar-nav > .active > a,.navbar-default .navbar-nav > .active > a:hover,.navbar-default .navbar-nav > .active > a:focus{color:#fff;background-color:#611329}.navbar-default .navbar-nav > .disabled > a,.navbar-default .navbar-nav > .disabled > a:hover,.navbar-default .navbar-nav > .disabled > a:focus{color:#ccc;background-color:transparent}.navbar-default .navbar-toggle{border-color:#a52a2a}.navbar-default .navbar-toggle:hover,.navbar-default .navbar-toggle:focus{background-color:#a52a2a}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse,.navbar-default .navbar-form{border-color:#611329}.navbar-default .navbar-nav > .open > a,.navbar-default .navbar-nav > .open > a:hover,.navbar-default .navbar-nav > .open > a:focus{background-color:#611329;color:#fff}@media (max-width: 767px){.navbar-default .navbar-nav .open .dropdown-menu > li > a{color:#fff}.navbar-default .navbar-nav .open .dropdown-menu > li > a:hover,.navbar-default .navbar-nav .open .dropdown-menu > li > a:focus{color:#fff;background-color:#a52a2a}.navbar-default .navbar-nav .open .dropdown-menu > .active > a,.navbar-default .navbar-nav .open .dropdown-menu > .active > a:hover,.navbar-default .navbar-nav .open .dropdown-menu > .active > a:focus{color:#fff;background-color:#611329}.navbar-default .navbar-nav .open .dropdown-menu > .disabled > a,.navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:hover,.navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:focus{color:#ccc;background-color:transparent}}.navbar-default .navbar-link{color:#fff}.navbar-default .navbar-link:hover{color:#fff}.navbar-default .btn-link{color:#fff}.navbar-default .btn-link:hover,.navbar-default .btn-link:focus{color:#fff}
.label{display:inline;padding:.2em .6em .3em;font-size:75%;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em}a.label:hover,a.label:focus{color:#fff;text-decoration:none;cursor:pointer}.label:empty{display:none}.btn .label{position:relative;top:-1px}.label-default{background-color:#777}.label-default[href]:hover,.label-default[href]:focus{background-color:#5e5e5e}.label-primary{background-color:#195eff}.label-primary[href]:hover,.label-primary[href]:focus{background-color:#0045e5}.label-success{background-color:#00bc16}.label-success[href]:hover,.label-success[href]:focus{background-color:#008910}.label-info{background-color:#5bc0de}.label-info[href]:hover,.label-info[href]:focus{background-color:#31b0d5}.label-warning{background-color:#f0ad4e}.label-warning[href]:hover,.label-warning[href]:focus{background-color:#ec971f}.label-danger{background-color:#d9534f}.label-danger[href]:hover,.label-danger[href]:focus{background-color:#c9302c}.badge{display:inline-block;min-width:10px;padding:3px 7px;font-size:14px;font-weight:700;color:#fff;line-height:1;vertical-align:middle;white-space:nowrap;text-align:center;background-color:#000;border-radius:10px}.badge:empty{display:none}.btn .badge{position:relative;top:-1px}.btn-xs .badge,.btn-group-xs > .btn .badge{top:0;padding:1px 5px}a.badge:hover,a.badge:focus{color:#fff;text-decoration:none;cursor:pointer}
.nav-pills > .active > a > .badge{color:#000;background-color:#fff}.nav-pills > li > a > .badge{margin-left:3px}
.clearfix:before,.clearfix:after,.container:before,.container:after,.container-fluid:before,.container-fluid:after,.row:before,.row:after,.form-horizontal .form-group:before,.form-horizontal .form-group:after,.nav:before,.nav:after,.navbar:before,.navbar:after,.navbar-header:before,.navbar-header:after,.navbar-collapse:before,.navbar-collapse:after{content:" ";display:table}.clearfix:after,.container:after,.container-fluid:after,.row:after,.form-horizontal .form-group:after,.nav:after,.navbar:after,.navbar-header:after,.navbar-collapse:after{clear:both}
.pull-right { float: right !important; } .pull-left { float: left !important; }

 
html { font-size:16px; }
body:not(.en) :lang(en), body:not(.el) :lang(el), body:not(.fr) :lang(fr) { display: none; }
body {
  font-size: 16px; line-height: 1.45; color: #000000;  background-color: #eceff1;
  margin: 0; padding-top: 70px; 
  font-family: 'Open Sans', 'Times New Roman', sans-serif;
  -webkit-animation: bugfix infinite 1s;
}
@-webkit-keyframes bugfix { from { fill: 0; } to { fill: 0; } }

a { color: #000; word-wrap: break-word; text-decoration: none; }
a:hover, a:focus, a:active { color: black; text-decoration: none; }
a.label { box-shadow: 2px 3px 4px 0px rgba(0,0,0,0.75); }
figure {  display: table; margin: 10px auto; }
figure figcaption { caption-side: bottom; color: darkblue; display: table-caption;
font-size: 14px; margin-top: 5px; text-align:justify; }
h1, h2, h3, h4, h5, h6 { margin:0px; text-align: justify; }
img { max-width: 100%; }
img.bordered { border:1px solid #021a40;  border-radius:20px; box-shadow: 2px 3px 4px 0px rgba(0,0,0,0.75); }
li { line-height: 1.5rem; text-align:justify; }
p { text-align:justify; text-indent: 30px; }
section { margin-top: 1rem; margin-bottom: 1rem; }
section>header { margin-bottom: .3rem; }
ul, ol { padding-left: 1.5rem; }

article .image { background-size: cover; background-position: center; }
article time { font-size: .8rem; }
article.grid { max-width:384px; margin-bottom:0.5rem; height:26rem; overflow: hidden; }
article.grid .image { min-height: 12rem; }
article.grid footer { padding: 1rem; background-color: #ffffe6; }
article.grid .title { overflow: hidden; }
article.grid .summary { color: #333; font-size: .8rem; line-height: 1rem; max-height: 5rem; overflow: hidden; }
article.single { background-color: #fff; margin: 0 auto; padding-bottom: 1rem; max-width:1200px; }
article.single .image { max-width:786px; min-height: 24rem; margin-left:auto; margin-right:auto; }
article.single .body { margin-bottom: 2rem;  padding: 0 5rem; }
article.single .body a:not(.label) { color: #78909c; text-decoration: underline; }
article.single .body>h1, article.single .body>h2, article.single .body>h3 { padding-top: 60px; margin-top: -30px; margin-bottom: 0.5rem; }
article.single .body li {  margin: 0.5rem auto; }
article.li { margin-bottom: .5rem; font-size: .8rem; line-height: 1rem; }
article.li .cell { display:table-cell; vertical-align: middle; }
article.li .image { width: 4.1rem; height: 4.1rem; box-shadow: 2px 3px 4px 0px rgba(0,0,0,0.75); }
article.li footer { display:table-cell; vertical-align: middle; padding-left: .5rem;  }
article.li time { font-size: .7rem; }
article.li .title { font-size: 0.85rem; line-height: 1rem; font-weight: 700; }

.body .title { font-size: 2rem; line-height: 3rem; margin: 0.5rem auto; }
.label { display:inline-block; padding-top: 0.25rem; }

.navbar * { color: white !important; }
.navbar .dropdown-menu a:hover { background-color: brown; }
.nav>li>a:hover, .nav>li>a:focus { color: white; background-color: brown; }
.nav-pills { display: inline-block; margin: 0; }
.nav-pills>li.active>a { font-weight: 700 !important; background-color: #00bc16 !important; }
.nav-pills>li.active>a .badge { color: #00bc16; }
.cssdropdown { margin-top: 2rem; }
.cssdropdown input[type=checkbox], .cssdropdown ul { display: none; }
.cssdropdown label { font-size: 1.25rem; font-weight:700; min-width: 300px; }
.cssdropdown input[type=checkbox]:checked ~ ul { display: table-cell; }

.p-logo {
  font-family: 'Comic Sans MS', cursive; font-weight: bold; font-size: 2rem;
  text-shadow: 4px 2px 2px rgba(0,0,0,0.75);
  margin-top: 3px;
}
.l-footer * { color: white; }
.l-footer { background-color: #7D1935; padding: 0.75rem 0; text-align: center; }

.lgfont { font-size: 2rem; }
.margin-sm { margin: 0.5rem; }
.side-margins-1 { margin-left: 1rem !important; margin-right: 1rem !important; }
.side-margins-2 { margin-left: 2rem !important;; margin-right: 2rem !important; }
.margin-top-sm {  margin-top: 0.5rem; }
.topmargin5 {  margin-top: 5px; }
.topmargin7 { margin-top: 7px; }

#search-section, #results-section { display:none; }
#TableOfContents ul { list-style: none; }
#TableOfContents>ul {  padding-left: 0; font-weight: 700; }
#TableOfContents>ul ul { font-weight: normal; }

.summary { text-align:justify; }
.max-width640 { max-width: 640px; }
.floatleft { float:left; margin-right: 10px; }
.floatright { float:right; margin-left: 10px; }

.centered { margin-left: auto !important;  margin-right: auto !important; }
img.centered { display:block !important; }
div.centered, p.centered, figcaption.centered, nav.centered, table.centered, h1.centered, h2.centered, h3.centered { text-align:center !important; }

@media (max-width: 768px) {
  h1 { font-size: 1.4rem; line-height: 1.5rem; }
  h2 { font-size: 1.2rem; line-height: 1.5rem; }
  article.single .image { min-height: 12rem; }
  article.single .body pre { margin: 1rem -1rem; }
  article.single .body pre code { padding: 1rem 1rem; }
  article.single .body { padding: 0 1rem; }
  ul.scroll-menu { max-height: 250px; }
  .cssdropdown label, .nav-stacked>li>a { min-width: 240px; }
  .hidden768 { display:none; }
  .text-smaller {
    font-family: 'Open Sans', 'Times New Roman', sans-serif;
    font-size: 1rem;  font-weight: 700; letter-spacing: -1px;
    padding-left: 0px !important;  padding-right: 0px !important;
    line-height:32px;
  }
}
</style>
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://alamot.github.io/index.xml">

  <link href="https://alamot.github.io/index.xml" rel="alternate" type="application/rss+xml" title="The Portal of Knowledge" />


  <title>How to write your own Web File Browser - The Portal of Knowledge</title>
  <meta property='og:title' content="How to write your own Web File Browser - The Portal of Knowledge">
  <meta property="og:type" content="article">
  <meta name="description" content="An article that provide guidance for writing your own Web File Browser in Python and Flask. Ένα άρθρο που παρέχει οδηγίες για το πως να γράψετε τον δικό σας Διαδικτυακό Περιηγητή Αρχείων χρησιμοποιώντας Python και Flask.">
  <meta property="og:description" content="An article that provide guidance for writing your own Web File Browser in Python and Flask. Ένα άρθρο που παρέχει οδηγίες για το πως να γράψετε τον δικό σας Διαδικτυακό Περιηγητή Αρχείων χρησιμοποιώντας Python και Flask.">
  <meta property="og:image" content="https://alamot.github.io/images/web_file_browser.jpg">
  <meta property="og:image:width" content="768" />
  <meta property="og:image:height" content="384" />

<meta property="og:url" content="https://alamot.github.io/web_file_browser/">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https:\/\/alamot.github.io\/"
    },
    "headline": "How to write your own Web File Browser |  ",
    "image": {
      "@type": "ImageObject",
      "url": "",
      "height": 700,
      "width": 700
    },
    "datePublished": "2022-05-11T00:00:00JST",
    "dateModified": "2022-05-11T00:00:00JST",
    "author": {
      "@type": "Person",
      "name": "Antonios Tsolis",
      "image": "https:\/\/alamot.github.io\/images/logo.png"
    },
    "publisher": {
      "@type": "Organization",
      "name": "",
      "logo": {
        "@type": "ImageObject",
        "url": "https:\/\/alamot.github.io\/images/logo.png",
        "height": 60,
        "width": 60
      }
    },
    "description": ""
  }
</script>
</head>
<body id="mainbody" class="en" lang="en">
<nav class="navbar navbar-default navbar-fixed-top centered">
<div class="container-fluid">
  
   <ul class="nav nav-pills pull-left topmargin7">
    <li id="content-selector" role="presentation" class="dropdown">
    <a class="dropdown-toggle btn-danger" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false"><span lang="en">Contents</span><span lang="el">Περιεχόμενα</span> <i class="fa fa-caret-down" aria-hidden="true"></i></a>
      <ul class="dropdown-menu scroll-menu">
        <li><a href="#title"><span lang="en">Start</span><span lang="el">Αρχή</span></a></li>
        
        
        
         
<li><a href="#intro"><span lang="en">Introduction</span><span lang="el">Εισαγωγή</span></a></li>
<li><a href="#code"><span lang="en">Backend code</span><span lang="el">Κώδικας πίσω μέρους</span></a>
<ul>
<li><a href="#requirements-txt">requirements.txt</a></li>
<li><a href="#config-py">config.py</a></li>
<li><a href="#fmsuite-init-py">fmsuite/__init__.py</a></li>
<li><a href="#fmsuite-filesystem-py">fmsuite/filesystem.py</a></li>
<li><a href="#fmsuite-thumbnail-py">fmsuite/thumbnail.py</a></li>
<li><a href="#worker-py">worker.py</a></li>
</ul></li>
<li><a href="#frontendcode"><span lang="en">Frontend code</span><span lang="el">Κώδικας εμπρόσθιου μέρους</span></a>
<ul>
<li><a href="#thirdpartycomponents"><span lang="en">Τhird-party components</span><span lang="el">Στοιχεία τρίτων</span></a></li>
<li><a href="#fmsuite-templates-layout-html">fmsuite/templates/layout.html</a></li>
<li><a href="#fmsuite-templates-folder-html">fmsuite/templates/folder.html</a></li>
</ul></li>
<li><a href="#runningcode"><span lang="en">Running the app</span><span lang="el">Εκτέλεση της εφαρμογής μας</span></a>
<ul>
<li><a href="#start-sh">./start.sh</a></li>
</ul></li>
<li><a href="#screenshots"><span lang="en">Screenshots</span><span lang="el">Στιγμιότυπα</span></a></li>
<li><a href="#fullcode"><span lang="en">Full code</span><span lang="el">Πλήρης κώδικας</span></a></li>
 
      
        <li><a href="#posts-section"><span lang="en">See also</span><span lang="el">Δείτε επίσης</span></a></li>
      </ul>
    </li>
   </ul>
  
   
  <ul class="nav nav-pills">
      <li><a class="p-logo" href="https://alamot.github.io/"><i class="fa fa-home" aria-hidden="true"></i> <span class="hidden768" lang="en">The Portal of Knowledge</span><span class="hidden768" lang="el">Η Πύλη της Γνώσης</span></a></li>
  </ul>
  
  <ul class="nav nav-pills pull-right topmargin7"> 
    <li id="lang-selector" role="presentation" class="dropdown">
      <a id="lang-index" class="dropdown-toggle btn-primary" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Language <i class="fa fa-caret-down" aria-hidden="true"></i></a>
      <ul class="dropdown-menu">
        <li><a id="en" href="#">English</a></li>
        <li><a id="el" href="#">Ελληνικά</a></li>
      </ul>
    </li>  
  </ul>
</div>
</nav>
<script>
langtext = "English";
language = localStorage.getItem('language');
if (language) {
  document.getElementById('mainbody').setAttribute('class', language);
  document.getElementById('mainbody').setAttribute('lang', language);
  if (language == 'el') { langtext="Ελληνικά"; }
  document.getElementById("lang-index").innerHTML=langtext+' <i class="fa fa-caret-down" aria-hidden="true"></i>';
}
</script>




<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <article class="single centered">
        <div class="image" style="background-image: url(https://alamot.github.io/images/web_file_browser.jpg);"></div>
        <div class="body">
            <header lang="en"><h1 id="title" class="title">How to write your own Web File Browser</h1></header>
            <header lang="el"><h1 class="title">Πως να γράψετε τον δικό σας Διαδικτυακό Περιηγητή Αρχείων</h1></header>
            <i class="fa fa-calendar topmargin7"  aria-hidden="true"></i>  
            <time lang="en" class="topmargin7">11 May 2022</time>
            <time lang="el" class="topmargin7">11 Μαϊ 2022</time>
            &middot; <i class="fa fa-folder-open-o topmargin7" aria-hidden="true"></i>
            
              <a class="label label-success topmargin7" href='https://alamot.github.io/categories/coding'>
                <span lang="en">Coding</span>
                <span lang="el">Προγραμματισμός</span>
              </a>
            
            &middot; <i class="fa fa-tags topmargin7" aria-hidden="true"></i>
            
              <a class="label label-primary topmargin7" href='https://alamot.github.io/tags/python'>
                <span lang="en">python</span>
                <span lang="el">python</span>
                </a>
            
              <a class="label label-primary topmargin7" href='https://alamot.github.io/tags/flask'>
                <span lang="en">flask</span>
                <span lang="el">flask</span>
                </a>
            
              <a class="label label-primary topmargin7" href='https://alamot.github.io/tags/web'>
                <span lang="en">web</span>
                <span lang="el">διαδίκτυο</span>
                </a>
            
              <a class="label label-primary topmargin7" href='https://alamot.github.io/tags/file'>
                <span lang="en">file</span>
                <span lang="el">αρχείο</span>
                </a>
            
              <a class="label label-primary topmargin7" href='https://alamot.github.io/tags/browser'>
                <span lang="en">browser</span>
                <span lang="el">περιηγητής</span>
                </a>
            
         
         <aside>
          <section>
            <header lang="en"><h2>Contents</h2></header>
            <header lang="el"><h2>Περιεχόμενα</h2></header>
            <div><nav id="TableOfContents">
<ul>
<li><a href="#intro"><span lang="en">Introduction</span><span lang="el">Εισαγωγή</span></a></li>
<li><a href="#code"><span lang="en">Backend code</span><span lang="el">Κώδικας πίσω μέρους</span></a>
<ul>
<li><a href="#requirements-txt">requirements.txt</a></li>
<li><a href="#config-py">config.py</a></li>
<li><a href="#fmsuite-init-py">fmsuite/__init__.py</a></li>
<li><a href="#fmsuite-filesystem-py">fmsuite/filesystem.py</a></li>
<li><a href="#fmsuite-thumbnail-py">fmsuite/thumbnail.py</a></li>
<li><a href="#worker-py">worker.py</a></li>
</ul></li>
<li><a href="#frontendcode"><span lang="en">Frontend code</span><span lang="el">Κώδικας εμπρόσθιου μέρους</span></a>
<ul>
<li><a href="#thirdpartycomponents"><span lang="en">Τhird-party components</span><span lang="el">Στοιχεία τρίτων</span></a></li>
<li><a href="#fmsuite-templates-layout-html">fmsuite/templates/layout.html</a></li>
<li><a href="#fmsuite-templates-folder-html">fmsuite/templates/folder.html</a></li>
</ul></li>
<li><a href="#runningcode"><span lang="en">Running the app</span><span lang="el">Εκτέλεση της εφαρμογής μας</span></a>
<ul>
<li><a href="#start-sh">./start.sh</a></li>
</ul></li>
<li><a href="#screenshots"><span lang="en">Screenshots</span><span lang="el">Στιγμιότυπα</span></a></li>
<li><a href="#fullcode"><span lang="en">Full code</span><span lang="el">Πλήρης κώδικας</span></a></li>
</ul>
</nav></div>
          </section>
         </aside>
        
        

<h1 id="intro"><span lang="en">Introduction</span><span lang="el">Εισαγωγή</span></h1>

<p lang="en">In this article, we will show how to implement a Web File Browser using the Python programming language and the <a href="https://flask.palletsprojects.com/" target="_blank">Flask</a> micro web framework. This will be a basic skeleton design. You can use it to develop your own "cloud" software which you can install it on a server and thus, have access to your files through a web interface. You can add whatever features you want.<p>
<p lang="el">Σε αυτό το άρθρο, θα δείξουμε πώς να υλοποιούμε έναν Διαδικτυακό Περιηγητή Αρχείων χρησιμοποιώντας τη γλώσσα προγραμματισμόυ Python και τη μικρo-πλατφόρμα <a href="https://flask.palletsprojects.com/" target="_blank">Flask</a>. Αυτό που κάνουμε θα είναι ένα βασικό σχέδιο σκελετός. Μπορείτε να το χρησιμοποιήσετε για να αναπτύξετε το δικό σας λογισμικό απομακρυσμένης πρόσβασης, το οποίο μπορείτε να εγκαταστήσετε σε έναν διακομιστή και έτσι να έχετε πρόσβαση στα αρχεία σας μέσω μιας διεπαφής ιστού (web interface). Μπορείτε να προσθέσετε οποιεσδήποτε λειτουργίες θέλετε.</p>

<h1 id="code"><span lang="en">Backend code</span><span lang="el">Κώδικας πίσω μέρους</span></h1>

<h2 id="requirements-txt">requirements.txt</h2>

<p lang="en">First of all, let's see what python packages we are going to make use of:</p>
<p lang="el">Πρώτα από όλα, ας δούμε τι πακέτα Python πρόκειται να χρησιμοποιήσουμε:</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">flask</span>
</span></span><span class="line"><span class="cl"><span class="n">flask</span><span class="o">-</span><span class="n">talisman</span>
</span></span><span class="line"><span class="cl"><span class="n">redis</span><span class="o">&gt;=</span><span class="mf">3.0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">rq</span><span class="o">&gt;=</span><span class="mf">1.2.0</span></span></span></code></pre></div>

<p lang="en"><a href="https://github.com/GoogleCloudPlatform/flask-talisman" target="_blank">Talisman</a> is a small Flask extension that facilitates the protection against a few common web application security issues.</p>
<p lang="en"><a href="https://python-rq.org/" target="_blank">RQ (Redis Queue)</a> is a simple Python library (backed by the <a href="https://redis.io/" target="_blank">Redis</a> database) for queueing jobs and processing them in parallel in the background with workers.</p>

<p lang="el">Το <a href="https://github.com/GoogleCloudPlatform/flask-talisman" target="_blank">Talisman</a> είναι μια μικρή επέκταση για το Flask που μας διευκολύνει στην προστασία έναντι μερικών κοινών θεμάτων ασφαλείας στις διαδικτυακές εφαρμογές.<p>
<p lang="el">Το <a href="https://python-rq.org/" target="_blank">RQ (Redis Queue)</a> είναι μια απλή βιβλιοθήκη της Python (υποστηριζόμενη από τη βάση δεδομένων <a https://redis.io/" target="_blank">Redis</a>) για την αναμονή εργασιών σε σειρά και την παράλληλη επεξεργασία τους στο περιθώριο μέσω εργατών.</p>

<h2 id="config-py">config.py</h2>

<p lang="en">This is our configuration file:</p>
<p lang="el">Αυτό είναι το αρχείο ρυθμίσεών μας:</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Enable/Disable Debugging</span>
</span></span><span class="line"><span class="cl"><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># What paths to show in our Web File Browser</span>
</span></span><span class="line"><span class="cl"><span class="n">SHARES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;/mnt/MEDIA/COMICS&#34;</span><span class="p">,</span> <span class="s2">&#34;/mnt/MEDIA/IMAGES&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show hidden (.dot) files?</span>
</span></span><span class="line"><span class="cl"><span class="n">SHOW_HIDDEN</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Absolute static path</span>
</span></span><span class="line"><span class="cl"><span class="n">ABS_STATIC_PATH</span> <span class="o">=</span> <span class="s2">&#34;/var/www/fmsuite/fmsuite/static/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Theme config</span>
</span></span><span class="line"><span class="cl"><span class="n">THEME</span> <span class="o">=</span> <span class="s2">&#34;red&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">REL_THEME_PATH</span> <span class="o">=</span> <span class="s2">&#34;img/themes/&#34;</span> <span class="o">+</span> <span class="n">THEME</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ABS_THEME_PATH</span> <span class="o">=</span> <span class="n">ABS_STATIC_PATH</span> <span class="o">+</span> <span class="n">REL_THEME_PATH</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Thumbnails config</span>
</span></span><span class="line"><span class="cl"><span class="n">THUMBNAILS</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">THUMB_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">THUMB_CREATION_TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl"><span class="n">REL_THUMB_PATH</span> <span class="o">=</span> <span class="s2">&#34;img/thumbs/&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ABS_THUMB_PATH</span> <span class="o">=</span> <span class="n">ABS_STATIC_PATH</span> <span class="o">+</span> <span class="n">REL_THUMB_PATH</span>
</span></span><span class="line"><span class="cl"><span class="n">THUMB_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="s2">&#34;video&#34;</span><span class="p">,</span> <span class="s2">&#34;pdf&#34;</span><span class="p">,</span> <span class="s2">&#34;epub&#34;</span><span class="p">,</span> <span class="s2">&#34;cbz&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a secret key (in order to use sessions)</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">secrets</span>
</span></span><span class="line"><span class="cl"><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">()</span></span></span></code></pre></div>

<h2 id="fmsuite-init-py">fmsuite/__init__.py</h2>

<p lang="en">Here is our main file, named __init__.py:</p>
<p lang="el">Εδώ είναι το κεντρικό μας αρχείο, που ονομάζεται __init__.py:</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rq</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">redis</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">mimetypes</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">send_file</span><span class="p">,</span> <span class="n">session</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask_talisman</span> <span class="kn">import</span> <span class="n">Talisman</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fmsuite</span> <span class="kn">import</span> <span class="n">filesystem</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fmsuite</span> <span class="kn">import</span> <span class="n">thumbnail</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SHARES</span><span class="p">,</span> <span class="n">THUMBNAILS</span><span class="p">,</span> <span class="n">THUMB_SIZE</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_csrf_token</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Generate a unique token in order to prevent
</span></span></span><span class="line"><span class="cl"><span class="s1">        CSRF (Cross-Site Request Forgery) attacks. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s2">&#34;_csrf_token&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">session</span><span class="p">[</span><span class="s2">&#34;_csrf_token&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">session</span><span class="p">[</span><span class="s2">&#34;_csrf_token&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Get a Redis db connection &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># g is a namespace object/proxy that store data during an application context/request.</span>
</span></span><span class="line"><span class="cl">    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;DB&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="o">.</span><span class="n">DB</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;localhost&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># If thumbnails are enabled, setup a RQ queue for the jobs</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">THUMBNAILS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span> <span class="o">=</span> <span class="n">rq</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="s2">&#34;thumbs&#34;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">DB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Init Flask app</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">static_url_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="s1">&#39;../config.py&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate_csrf_token</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;werkzeug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Content Security Policy for Flask-Talisman</span>
</span></span><span class="line"><span class="cl"><span class="n">csp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;default-src&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;&#39;self&#39;&#34;</span><span class="p">,</span> <span class="s2">&#34;blob:&#34;</span><span class="p">,</span> <span class="s2">&#34;data:&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="s2">&#34;script-src&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;&#39;self&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="s2">&#34;&#39;sha256-2pWe29RAjmUSi77PP/nCW8IcD9XnGs0VJaq+dLPBlzg=&#39;&#34;</span> <span class="c1"># For Readium</span>
</span></span><span class="line"><span class="cl">                     <span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="s2">&#34;style-src&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;&#39;self&#39;&#34;</span><span class="p">,</span> <span class="s2">&#34;blob:&#34;</span><span class="p">,</span> <span class="s2">&#34;&#39;unsafe-inline&#39;&#34;</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">talisman</span> <span class="o">=</span> <span class="n">Talisman</span><span class="p">(</span><span class="n">app</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">content_security_policy</span><span class="o">=</span><span class="n">csp</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">content_security_policy_nonce_in</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;script-src&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">before_first_request</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">initialization</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Run only once, before the first request. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Get a Redis db connection</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_db</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Prepare unique IDs for all the shared dirs and files. All access is done through</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># those unique IDs (thus, we avoid path traversal and many other types of attacks).</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&#34;Preparing unique IDs for all the shared dirs and files. Please wait...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">share</span> <span class="ow">in</span> <span class="n">SHARES</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">filesystem</span><span class="o">.</span><span class="n">prepare_uids_recursively</span><span class="p">(</span><span class="n">share</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&#34;READY&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">before_request</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_init</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Run before each request &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Get &#34;view&#34; setting value from cookie (or use value &#34;#gallery-view&#34; as default).</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">VIEW</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;view&#34;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&#34;#gallery-view&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Get a Redis db connection.</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_db</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; View function for / &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="n">filesystem</span><span class="o">.</span><span class="n">get_path_contents</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;folder.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">paths</span><span class="o">=</span><span class="n">filesystem</span><span class="o">.</span><span class="n">get_paths</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">SHARES</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/epub_reader/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">epub_reader</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; View function for /epub_reader &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;epub_reader.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/explore/&lt;uid&gt;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">explore_path</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; View function for /explore/&lt;uid&gt;/ &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="n">filesystem</span><span class="o">.</span><span class="n">get_path_contents</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;folder.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">paths</span><span class="o">=</span><span class="n">filesystem</span><span class="o">.</span><span class="n">get_paths</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">SHARES</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="n">dirs</span><span class="o">=</span><span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/serve/&lt;uid&gt;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">serve_file</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Serve file. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">mimetype</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span> <span class="n">conditional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/get/&lt;uid&gt;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_file</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Get (i.e. download) file. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">mimetype</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/job/finished/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_finished_thumbs</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Get finished thumbnail jobs. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">([])</span>
</span></span><span class="line"><span class="cl">    <span class="n">job_ids</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="o">.</span><span class="n">finished_job_registry</span><span class="o">.</span><span class="n">get_job_ids</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_ids</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="o">.</span><span class="n">scheduled_job_registry</span><span class="o">.</span><span class="n">get_job_ids</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="o">.</span><span class="n">started_job_registry</span><span class="o">.</span><span class="n">get_job_ids</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="s2">&#34;empty&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">([])</span>
</span></span><span class="line"><span class="cl">    <span class="n">thumb_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="n">job_ids</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Clean finished jobs</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="n">job_ids</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="o">.</span><span class="n">finished_job_registry</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">delete_job</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">thumb_ids</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&#34;/refresh/&lt;uid&gt;/&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">refresh_path</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Refresh thumbnail. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">jobid</span> <span class="o">=</span> <span class="n">thumbnail</span><span class="o">.</span><span class="n">refresh_thumbnail</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">THUMB_SIZE</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">RQ_THUMBS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app</span><span class="o">.</span><span class="n">template_filter</span><span class="p">(</span><span class="s2">&#34;mime2type&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">jinja_mime2type</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Jinja2 filter to get the media type from a MIME type. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">filesystem</span><span class="o">.</span><span class="n">mime2type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></span></span></code></pre></div>

<h2 id="fmsuite-filesystem-py">fmsuite/filesystem.py</h2>

<p lang="en">Here is our filesystem.py, which contain all the functionality related to files and directories:</p>
<p lang="el">Εδώ είναι το αρχείο μας filesystem.py, που εμπεριέχει όλη τη λειτουργικότητα σχετικά με τα αρχεία και τους φακέλους:</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">mimetypes</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">url_for</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SHARES</span><span class="p">,</span> <span class="n">SHOW_HIDDEN</span><span class="p">,</span> <span class="n">REL_THEME_PATH</span><span class="p">,</span> <span class="n">REL_THUMB_PATH</span><span class="p">,</span> <span class="n">THUMB_SIZE</span><span class="p">,</span> <span class="n">THUMB_TYPES</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fmsuite</span> <span class="kn">import</span> <span class="n">mediatypes</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fmsuite</span> <span class="kn">import</span> <span class="n">thumbnail</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_path_uid</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Get a unique (but computable/deterministic) ID for a path. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha3_512</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">usedforsecurity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_path_contents</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">thumbs_rq</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Returns the contents of a path (dirs, files). &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># If path == &#34;/&#34; return the SHARES instead.</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s2">&#34;/&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">share</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="n">share</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;stat&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">share</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;uid&#34;</span><span class="p">:</span> <span class="n">get_path_uid</span><span class="p">(</span><span class="n">share</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;thumb&#34;</span><span class="p">:</span> <span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;static&#34;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">REL_THEME_PATH</span> <span class="o">+</span> <span class="s2">&#34;folder_&#34;</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">                                  <span class="n">mediatypes</span><span class="o">.</span><span class="n">folder2type</span><span class="p">(</span><span class="n">share</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;.svg&#34;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">share</span> <span class="ow">in</span> <span class="n">SHARES</span><span class="p">],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># We use os.scandir() to get the contents of a path</span>
</span></span><span class="line"><span class="cl">    <span class="n">dirs</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">contents</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Hide hidden files?</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">SHOW_HIDDEN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># File</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;mime&#34;</span><span class="p">:</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;stat&#34;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">stat</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;uid&#34;</span><span class="p">:</span> <span class="n">get_path_uid</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Setup thumbnail</span>
</span></span><span class="line"><span class="cl">            <span class="n">mtype</span> <span class="o">=</span> <span class="n">mediatypes</span><span class="o">.</span><span class="n">mime2type</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s2">&#34;mime&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">thumbs_rq</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mtype</span> <span class="ow">in</span> <span class="n">THUMB_TYPES</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Make a thumbnail, if possible (we enqueue a RQ job)</span>
</span></span><span class="line"><span class="cl">                <span class="n">job</span> <span class="o">=</span> <span class="n">thumbs_rq</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">thumbnail</span><span class="o">.</span><span class="n">make_thumbnail</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                        <span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">],</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">THUMB_SIZE</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">failure_ttl</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Store the job ID -&gt; Unique file ID association in the db</span>
</span></span><span class="line"><span class="cl">                <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Stote the URL path for our thumbnail</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span><span class="p">[</span><span class="s2">&#34;thumb&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;static&#34;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">REL_THUMB_PATH</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                                                        <span class="s2">&#34;/&#34;</span> <span class="o">+</span>  <span class="n">f</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34;.jpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Otherwise, use the generic icon for the medium type</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span><span class="p">[</span><span class="s2">&#34;thumb&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;static&#34;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">REL_THEME_PATH</span> <span class="o">+</span> <span class="s2">&#34;file_&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                                                        <span class="n">mtype</span> <span class="o">+</span> <span class="s2">&#34;.svg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Add file to the list of files</span>
</span></span><span class="line"><span class="cl">            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Associate the unique ID of the file with its path in the db.</span>
</span></span><span class="line"><span class="cl">            <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Directory</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;stat&#34;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">stat</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;uid&#34;</span><span class="p">:</span> <span class="n">get_path_uid</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                 <span class="s2">&#34;thumb&#34;</span><span class="p">:</span> <span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;static&#34;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">REL_THEME_PATH</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                                  <span class="s2">&#34;folder_&#34;</span> <span class="o">+</span> <span class="n">mediatypes</span><span class="o">.</span><span class="n">folder2type</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;.svg&#34;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Add directory to the list of directories</span>
</span></span><span class="line"><span class="cl">            <span class="n">dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Associate the unique ID of the directory with its path in the db.</span>
</span></span><span class="line"><span class="cl">            <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Sort the lists of dirs and files</span>
</span></span><span class="line"><span class="cl">    <span class="n">dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">casefold</span><span class="p">(),</span> <span class="n">e</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">casefold</span><span class="p">(),</span> <span class="n">e</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_paths</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;/&#34;</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Get a list of tupples [(last folder, full path), ...] of all the paths included in
</span></span></span><span class="line"><span class="cl"><span class="s1">        a path. e.g.: If path is &#34;/home/bob/&#34; -&gt; [(&#34;home&#34;, &#34;/home&#34;), (&#34;bob&#34;, &#34;/home/bob&#34;)]. 
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">suppaths</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">p</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="n">folder</span>
</span></span><span class="line"><span class="cl">        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">folder</span><span class="p">,</span> <span class="s2">&#34;path&#34;</span><span class="p">:</span> <span class="n">fullpath</span><span class="p">,</span> <span class="s2">&#34;uid&#34;</span><span class="p">:</span> <span class="n">get_path_uid</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">        <span class="n">suppaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">fullpath</span> <span class="ow">in</span> <span class="n">limits</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">suppaths</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prepare_uids_recursively</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;  Prepare unique IDs for all the shared dirs and files.
</span></span></span><span class="line"><span class="cl"><span class="s1">         All access is done through those unique IDs.
</span></span></span><span class="line"><span class="cl"><span class="s1">         (thus, we avoid path traversal and many other types of attacks). 
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Set a unique ID for this path (it&#39;s a directory) in the db</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">get_path_uid</span><span class="p">(</span><span class="n">dir_path</span><span class="p">),</span> <span class="n">dir_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># We use os.scandir() to get the contents of a directory</span>
</span></span><span class="line"><span class="cl">    <span class="n">contents</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">SHOW_HIDDEN</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Hide hidden files</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span> 
</span></span><span class="line"><span class="cl">            <span class="c1"># Directory</span>
</span></span><span class="line"><span class="cl">            <span class="n">prepare_uids_recursively</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>          
</span></span><span class="line"><span class="cl">            <span class="c1"># File: Get a unique ID for this</span>
</span></span><span class="line"><span class="cl">            <span class="n">uid</span> <span class="o">=</span> <span class="n">get_path_uid</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Set the unique ID for this file path in the db.</span>
</span></span><span class="line"><span class="cl">            <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">path</span><span class="p">)</span></span></span></code></pre></div>

<h2 id="fmsuite-thumbnail-py">fmsuite/thumbnail.py</h2>

<p lang="en">Here is our thumbnail.py, where the creation of thumbnails take place. We use RQ (Redis Queue) to queue the thumbnailing jobs in order to process them in parallel in the background, mobilizing as many workers as we want.</p>
<p lang="el">Εδώ είναι το thumbnail.py, όπου λαμβάνει χώρα η δημιουργία των μικρογραφιών. Χρησιμοποιούμε το RQ (Redis Queue) για να βάλουμε σε σειρά αναμονής τις εργασίες μικρογράφησης ώστε να τις επεξεργαζόμαστε με παραλληλία στο περιθώριο, επιστρατεύοντας όσους εργάτες θέλουμε.</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">shutil</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">zipfile</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">url_for</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">UnidentifiedImageError</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">ABS_THEME_PATH</span><span class="p">,</span> <span class="n">ABS_THUMB_PATH</span><span class="p">,</span> <span class="n">THUMB_CREATION_TIMEOUT</span><span class="p">,</span> <span class="n">THUMB_TYPES</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fmsuite</span> <span class="kn">import</span> <span class="n">filesystem</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fmsuite</span> <span class="kn">import</span> <span class="n">mediatypes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># XML namespaces for the EPUB format (these are used to avoid name conflicts in elements).</span>
</span></span><span class="line"><span class="cl"><span class="n">namespaces</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;u&#39;</span><span class="p">:</span><span class="s2">&#34;urn:oasis:names:tc:opendocument:xmlns:container&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;xsi&#39;</span><span class="p">:</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;opf&#39;</span><span class="p">:</span><span class="s2">&#34;http://www.idpf.org/2007/opf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;dcterms&#39;</span><span class="p">:</span><span class="s2">&#34;http://purl.org/dc/terms/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;calibre&#39;</span><span class="p">:</span><span class="s2">&#34;http://calibre.kovidgoyal.net/2009/metadata&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;dc&#39;</span><span class="p">:</span><span class="s2">&#34;http://purl.org/dc/elements/1.1/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_image_thumbnail</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">target_size</span><span class="p">,</span> <span class="n">out_thumb_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Make a thumbnail with target size by cropping out a maximal region from an image. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># If image is too tall, crop some off from top and bottom</span>
</span></span><span class="line"><span class="cl">        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale_factor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top</span> <span class="o">+</span> <span class="n">height</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># If image is too wide, crop some off from left and right</span>
</span></span><span class="line"><span class="cl">        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale_factor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="n">left</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Resize cropped image</span>
</span></span><span class="line"><span class="cl">    <span class="n">thumb</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">target_size</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Convert mode to RGB</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">thumb</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&#34;RGBA&#34;</span><span class="p">,</span> <span class="s2">&#34;LA&#34;</span><span class="p">,</span> <span class="s2">&#34;P&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">new</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&#34;RGB&#34;</span><span class="p">,</span> <span class="n">thumb</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">new</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">thumb</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">thumb</span> <span class="o">=</span> <span class="n">new</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Save thumbnail</span>
</span></span><span class="line"><span class="cl">    <span class="n">thumb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">out_thumb_path</span><span class="p">,</span> <span class="s2">&#34;JPEG&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_thumbnail</span><span class="p">(</span><span class="n">in_file_path</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">thumb_size</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Make a thumbnail for a file. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">thumb_dir</span> <span class="o">=</span> <span class="n">ABS_THUMB_PATH</span> <span class="o">+</span> <span class="n">uid</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_thumb_path</span> <span class="o">=</span> <span class="n">thumb_dir</span> <span class="o">+</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&#34;.jpg&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_thumb_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create thumbnail directory if it doesn&#39;t exist</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">thumb_dir</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">         <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">thumb_dir</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">mtype</span> <span class="o">==</span> <span class="s2">&#34;image&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Open image</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">in_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">im</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Create image thumbnail</span>
</span></span><span class="line"><span class="cl">            <span class="n">create_image_thumbnail</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">thumb_size</span><span class="p">,</span> <span class="n">out_thumb_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">mtype</span> <span class="o">==</span> <span class="s2">&#34;video&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># We use ffmpeg to create a thumbnail for the video files</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;ffmpeg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-loglevel&#34;</span><span class="p">,</span> <span class="s2">&#34;fatal&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-i&#34;</span><span class="p">,</span>  <span class="n">in_file_path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-ss&#34;</span><span class="p">,</span> <span class="s2">&#34;120&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-vframes&#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-s&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">thumb_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34;x&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thumb_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-filter:v&#34;</span><span class="p">,</span> <span class="s2">&#34;scale=&#39;min(&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thumb_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34;\,iw):-1&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-y&#34;</span><span class="p">,</span> <span class="n">out_thumb_path</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                           <span class="n">timeout</span><span class="o">=</span><span class="n">THUMB_CREATION_TIMEOUT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">mtype</span> <span class="o">==</span> <span class="s2">&#34;pdf&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># We use imagemagick to create a thumbnail for the pdf files</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;convert&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-flatten&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-density&#34;</span><span class="p">,</span> <span class="s2">&#34;300&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;-resize&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">thumb_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34;x&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thumb_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">                            <span class="n">in_file_path</span> <span class="o">+</span> <span class="s2">&#34;[0]&#34;</span><span class="p">,</span>  <span class="n">out_thumb_path</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                           <span class="n">timeout</span><span class="o">=</span><span class="n">THUMB_CREATION_TIMEOUT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">mtype</span> <span class="o">==</span> <span class="s2">&#34;cbz&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Decompress first image from cbz archive</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">in_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">namelist</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;/&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">with</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="k">as</span> <span class="n">zm</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">zm</span><span class="p">)</span> <span class="k">as</span> <span class="n">im</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="c1"># Create image thumbnail</span>
</span></span><span class="line"><span class="cl">                            <span class="n">create_image_thumbnail</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">thumb_size</span><span class="p">,</span> <span class="n">out_thumb_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">mtype</span> <span class="o">==</span> <span class="s2">&#34;epub&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Get EPUB cover image</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">in_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">t</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&#34;META-INF/container.xml&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">rootfile_path</span> <span class="o">=</span>  <span class="n">t</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;/u:container/u:rootfiles/u:rootfile&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                     <span class="n">namespaces</span><span class="o">=</span><span class="n">namespaces</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;full-path&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">t</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">rootfile_path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">cover_id</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//opf:metadata/opf:meta[@name=&#39;cover&#39;]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">namespaces</span><span class="o">=</span><span class="n">namespaces</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;content&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">cover_href</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//opf:manifest/opf:item[@id=&#39;&#34;</span> <span class="o">+</span> <span class="n">cover_id</span> <span class="o">+</span> <span class="s2">&#34;&#39;]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">namespaces</span><span class="o">=</span><span class="n">namespaces</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">cover_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">rootfile_path</span><span class="p">),</span> <span class="n">cover_href</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cover_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">zm</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">zm</span><span class="p">)</span> <span class="k">as</span> <span class="n">im</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Create image thumbnail</span>
</span></span><span class="line"><span class="cl">                    <span class="n">create_image_thumbnail</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">thumb_size</span><span class="p">,</span> <span class="n">out_thumb_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># If thumbnail creation failed, copy the image of a failed icon in its place.</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_thumb_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ABS_THEME_PATH</span> <span class="o">+</span> <span class="s2">&#34;thumb_failed.jpg&#34;</span><span class="p">,</span> <span class="n">out_thumb_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">refresh_thumbnail</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">thumb_size</span><span class="p">,</span> <span class="n">thumbs_rq</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39; Refresh the thumbnail. &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">mtype</span> <span class="o">=</span> <span class="n">mediatypes</span><span class="o">.</span><span class="n">get_path_type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">mtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">THUMB_TYPES</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Enqueue a RQ job</span>
</span></span><span class="line"><span class="cl">        <span class="n">job</span> <span class="o">=</span> <span class="n">thumbs_rq</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">make_thumbnail</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">thumb_size</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">failure_ttl</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Store the job ID -&gt; Unique file ID association in the db</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="o">.</span><span class="n">DB</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">job</span><span class="o">.</span><span class="n">id</span></span></span></code></pre></div>

<h2 id="worker-py">worker.py</h2>

<p lang="en">Here is our worker.py:</p>
<p lang="el">Εδώ είναι το worker.py:</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rq</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Preload libraries for the worker</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">shutil</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">zipfile</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">url_for</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">UnidentifiedImageError</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">ABS_THEME_PATH</span><span class="p">,</span> <span class="n">ABS_THUMB_PATH</span><span class="p">,</span> <span class="n">THUMB_CREATION_TIMEOUT</span><span class="p">,</span> <span class="n">THUMB_TYPES</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fmsuite</span> <span class="kn">import</span> <span class="n">filesystem</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fmsuite</span> <span class="kn">import</span> <span class="n">mediatypes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Logging setup</span>
</span></span><span class="line"><span class="cl"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&#34;rq.worker&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s2">&#34;workers.log&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%(asctime)s</span><span class="s2"> | </span><span class="si">%(levelname)s</span><span class="s2"> | PID </span><span class="si">%(process)d</span><span class="s2"> | </span><span class="si">%(message)s</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Provide queue names to listen to as arguments to this script,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># similar to rq worker</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">rq</span><span class="o">.</span><span class="n">Connection</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">w</span> <span class="o">=</span> <span class="n">rq</span><span class="o">.</span><span class="n">Worker</span><span class="p">([</span><span class="s2">&#34;thumbs&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">w</span><span class="o">.</span><span class="n">work</span><span class="p">()</span></span></span></code></pre></div>

<h1 id="frontendcode"><span lang="en">Frontend code</span><span lang="el">Κώδικας εμπρόσθιου μέρους</span></h1>

<h2 id="thirdpartycomponents"><span lang="en">Τhird-party components</span><span lang="el">Στοιχεία τρίτων</span></h2>

<p lang="en">We make use of several (free) third-party components:</p>
<p lang="el">Κάνουμε χρήση αρκετών (δωρεάν) στοιχείων από τρίτους:</p>

<ul>
<li><a href="https://github.com/ColorlibHQ/AdminLTE" target="_blank">AdminLTE</a></li>
<li><a href="https://getbootstrap.com/" target="_blank">Bootstrap</a></li>
<li><a href="https://datatables.net/" target="_blank">Datatables</a></li>
<li><a href="https://fontawesome.com/" target="_blank">Font Awesome</a></li>
<li><a href="https://jquery.com/" target="_blank">jQuery</a></li>
<li><a href="https://github.com/readium/readium-js-viewer" target="_blank">Readium</a></li>
<li><a href="https://github.com/andreknieriem/simplelightbox" target="_blank">SimpleLightbox</a></li>
</ul>

<h2 id="fmsuite-templates-layout-html">fmsuite/templates/layout.html</h2>

<p lang="en">Here is our jinja template for the basic layout. Notice the "nonce" attributes in the style and script elements. The <i>nonce</i> attribute is a way to indicate (to the browsers) that the inline contents of a particular style or script element were put in the document by the serve and weren’t injected by some malicious third party.</p>
<p lang="el">Εδώ είναι το jinja πρότυπο της βασική μας διάταξης (layout). Παρατηρείστε τις ιδιότητες "nonce" στα στοιχεία ύφους (style) και σεναρίου (script). Η ιδιότητα <i>nonce</i> είναι ένας τρόπος για να υποδείξουμε (στους περιηγητές) ότι τα περιέχομενα ενός συγκεκριμένου στοιχείου ύφους ή σεναρίου μπήκαν στο έγγραφο από τον διακομιστή και δεν είναι εμβόλιμα από κάποιον κακόβουλο τρίτο.</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;x-ua-compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;ie=edge&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}FM Suite{% endblock title %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;shortcut icon&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ url_for(&#39;static&#39;, filename=&#39;favicon.ico&#39;) }}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Font Awesome Icons --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{url_for(&#39;static&#39;,filename=&#39;css/font-awesome.min.css&#39;)}}&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- simplelightbox --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{url_for(&#39;static&#39;,filename=&#39;css/simplelightbox.min.css&#39;)}}&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Datatables --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{url_for(&#39;static&#39;,filename=&#39;css/datatables.min.css&#39;)}}&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- AdminLTE style --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{url_for(&#39;static&#39;,filename=&#39;css/adminlte.min.css&#39;)}}&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Our own CSS --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{url_for(&#39;static&#39;,filename=&#39;css/fmsuite.css&#39;)}}&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hold-transition layout-navbar-fixed sidebar-collapse&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wrapper&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Navbar --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;main-header navbar navbar-expand navbar-white navbar-light border-bottom&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Left navbar links --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav nav-pills&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;tablist&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link {% if g.VIEW == &#34;</span><span class="err">#</span><span class="na">gallery-view</span><span class="err">&#34;</span> <span class="err">%}</span><span class="na">active</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}&#34;</span>
</span></span><span class="line"><span class="cl">             <span class="na">aria-selected</span><span class="o">=</span><span class="s">&#34;true&#34;</span> <span class="na">data-toggle</span><span class="o">=</span><span class="s">&#34;pill&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#gallery-view&#34;</span> 
</span></span><span class="line"><span class="cl">             <span class="na">role</span><span class="o">=</span><span class="s">&#34;tab&#34;</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;fa fa-th&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link {% if g.VIEW == &#34;</span><span class="err">#</span><span class="na">tables-view</span><span class="err">&#34;</span> <span class="err">%}</span><span class="na">active</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}&#34;</span> 
</span></span><span class="line"><span class="cl">             <span class="na">aria-selected</span><span class="o">=</span><span class="s">&#34;false&#34;</span> <span class="na">data-toggle</span><span class="o">=</span><span class="s">&#34;pill&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#tables-view&#34;</span> 
</span></span><span class="line"><span class="cl">             <span class="na">role</span><span class="o">=</span><span class="s">&#34;tab&#34;</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;fa fa-list&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- SEARCH FORM --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-inline ml-auto&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;input-group input-group-sm&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control form-control-navbar&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;search&#34;</span> 
</span></span><span class="line"><span class="cl">               <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Filter&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Search&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;filter-search&#34;</span><span class="p">&gt;</span>      
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-nav ml-auto&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;logout&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;fa fa-sign-out&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span> <span class="c">&lt;!-- /.navbar --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Content Wrapper. Contains page content --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Content Header (Page header) --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-header&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container-fluid&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        {% block header %}
</span></span><span class="line"><span class="cl">        {% endblock header %}
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="c">&lt;!-- /.container-fluid --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- /.content-header --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Main content --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container-fluid&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        {% block content %}
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--------------------------
</span></span></span><span class="line"><span class="cl"><span class="c">          | Your Page Content Here |
</span></span></span><span class="line"><span class="cl"><span class="c">          --------------------------&gt;</span>
</span></span><span class="line"><span class="cl">        {% endblock content %}
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="c">&lt;!--/. container-fluid --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span><span class="c">&lt;!-- /.content --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span><span class="c">&lt;!-- /.content-wrapper --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Main Footer --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">footer</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;main-footer&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- To the right --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;float-right d-sm-none d-md-block&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      2022
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Default to the left --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Alamot Software<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  {% include &#34;messages.html&#34; %}
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> <span class="c">&lt;!-- ./wrapper --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- jQuery --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ url_for(&#39;static&#39;,filename=&#39;js/jquery.js&#39;) }}&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Bootstrap --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ url_for(&#39;static&#39;,filename=&#39;js/bootstrap.bundle.min.js&#39;) }}&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- simple-lightbox --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ url_for(&#39;static&#39;,filename=&#39;js/simple-lightbox.js&#39;) }}&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- DataTables --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ url_for(&#39;static&#39;,filename=&#39;js/datatables.min.js&#39;) }}&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- AdminLTE App --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ url_for(&#39;static&#39;,filename=&#39;js/adminlte.min.js&#39;) }}&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- SlimScroll 1.3.0 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ url_for(&#39;static&#39;,filename=&#39;js/jquery.slimscroll.min.js&#39;) }}&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;{{ csp_nonce() }}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a[data-toggle=&#34;pill&#34;]&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Saves the &#34;#gallery-view&#34; or &#34;#table-view&#34; setting to a cookie named &#34;view&#34; */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="s1">&#39;view=&#39;</span><span class="o">+</span><span class="nx">target</span><span class="o">+</span><span class="s1">&#39;;expires=Fri, 31 Dec 9999 23:59:59 GMT;path=/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#flashed-messages-modal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&#34;show&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">dataTable</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="p">{</span> <span class="nx">mark</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">block</span> <span class="nx">js</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">endblock</span> <span class="nx">js</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span></span></span></code></pre></div>

<h2 id="fmsuite-templates-folder-html">fmsuite/templates/folder.html</h2>

<p lang="en">Here is our jinja template for the presentation of the contents of a folder. We implement two different views in two tab panes: a gallery view and a table view (using <a href="https://datatables.net/" target="_blank">Datatables</a>).</p>

<p lang="el">Εδώ είναι το jinja πρότυπο μας για την παρουσίαση των περιεχομένων ενός φακέλου. Υλοποιούμε δύο διαφορετικές απεικονίσεις σε δύο παράθυρα καρτέλες (tab panes): μία εκθεσιακή απεικόνιση (gallery view) και μια απεικόνιση πίνακα (table view, χρησιμοποιώντας τα <a href="https://datatables.net/" target="_blank">Datatables</a>).</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="kr">extends</span> <span class="s2">&#34;layout.html&#34;</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">block</span> <span class="nx">header</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;row mb-2&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;col-sm-12&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">ol</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;breadcrumb&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">li</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;breadcrumb-item&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;{{ url_for(&#39;index&#39;) }}&#34;</span><span class="o">&gt;&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;fa fa-home&#34;</span><span class="o">&gt;&lt;</span><span class="err">/i&gt;&lt;/a&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="err">/li&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">e</span> <span class="k">in</span> <span class="nx">paths</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">li</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;breadcrumb-item&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;{{ url_for(&#39;explore_path&#39;, uid=e[&#39;uid&#39;]) }}&#34;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">e</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/a&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="err">/li&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/ol&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="sr">/div&gt;&lt;!-- /</span><span class="p">.</span><span class="nx">col</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="sr">/div&gt;&lt;!-- /</span><span class="p">.</span><span class="nx">row</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">endblock</span> <span class="nx">header</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">block</span> <span class="nx">title</span> <span class="o">%</span><span class="p">}</span><span class="nx">FM</span> <span class="nx">Suite</span><span class="p">{</span><span class="o">%</span> <span class="nx">endblock</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">block</span> <span class="nx">content</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;tab-content&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--</span> <span class="nx">tab</span><span class="o">-</span><span class="nx">pane</span> <span class="nx">gallery</span><span class="o">-</span><span class="nx">view</span>  <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;tab-pane filter-container row p-0 align-items-end fade {% if g.VIEW == &#39;#gallery-view&#39; %}show active{% endif %}&#34;</span> 
</span></span><span class="line"><span class="cl">     <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;gallery-view&#34;</span> <span class="nx">role</span><span class="o">=</span><span class="s2">&#34;tabpanel&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">dir</span> <span class="k">in</span> <span class="nx">dirs</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;fm-item col-lg-2 col-md-3 col-sm-4 col-6&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;small-box bg-white&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;inner&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;{{ url_for(&#39;explore_path&#39;, uid=dir[&#39;uid&#39;]) }}&#34;</span><span class="o">&gt;&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;{{ dir[&#39;thumb&#39;] }}&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;img-fluid mx-auto d-block align-middle&#34;</span> <span class="nx">alt</span><span class="o">=</span><span class="s2">&#34;folder&#34;</span><span class="o">/&gt;&lt;</span><span class="err">/a&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">a</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;small-box-footer text-truncate px-2&#34;</span> 
</span></span><span class="line"><span class="cl">         <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;{{ url_for(&#39;explore_path&#39;, uid=dir[&#39;uid&#39;]) }}&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="nx">title</span><span class="o">=</span><span class="s2">&#34;{{ dir[&#39;name&#39;] }}&#34;</span><span class="o">&gt;&lt;</span><span class="nx">small</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">dir</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/small&gt;&lt;/a&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">file</span> <span class="k">in</span> <span class="nx">files</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;fm-item col-lg-2 col-md-3 col-sm-4 col-6&#34;</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;small-box bg-white&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;inner&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">a</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;slb-item&#34;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;{{ url_for(&#39;serve_file&#39;, uid=file[&#39;uid&#39;]) }}&#34;</span> 
</span></span><span class="line"><span class="cl">           <span class="nx">title</span><span class="o">=</span><span class="s2">&#34;{{ file[&#39;name&#39;] }}&#34;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;{{ file[&#39;mime&#39;] }}&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">             <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;{{ file[&#39;uid&#39;] }}&#34;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;{{ file[&#39;thumb&#39;] }}&#34;</span> 
</span></span><span class="line"><span class="cl">                  <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;img-fluid mx-auto d-block align-middle&#34;</span> <span class="nx">alt</span><span class="o">=</span><span class="s2">&#34;{{ file[&#39;mime&#39;] }}&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/a&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">a</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;small-box-footer text-truncate px-2&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;{{ url_for(&#39;get_file&#39;, uid=file[&#39;uid&#39;]) }}&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="nx">title</span><span class="o">=</span><span class="s2">&#34;{{ file[&#39;name&#39;] }}&#34;</span> <span class="nx">download</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">           <span class="o">&lt;</span><span class="nx">small</span><span class="o">&gt;&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;fa fa-download&#34;</span><span class="o">&gt;&lt;</span><span class="err">/i&gt; {{ file[&#39;name&#39;] }}&lt;/small&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/a&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/div&gt; &lt;!-- tab-pane gallery-view end --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--</span> <span class="nx">tab</span><span class="o">-</span><span class="nx">pane</span> <span class="nx">tables</span><span class="o">-</span><span class="nx">view</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;tab-pane row p-0 fade {% if g.VIEW == &#39;#tables-view&#39; %}show active{% endif %}&#34;</span> 
</span></span><span class="line"><span class="cl">     <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;tables-view&#34;</span> <span class="nx">role</span><span class="o">=</span><span class="s2">&#34;tabpanel&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;card col-12&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;card-body&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">table</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;folder-contents&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;table table-striped table-hover&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">th</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;</span><span class="nx">Name</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">th</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;</span><span class="nx">Mime</span> <span class="nx">type</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">th</span> <span class="nx">data</span><span class="o">-</span><span class="nx">order</span><span class="o">=</span><span class="s2">&#34;0&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;</span><span class="nx">Size</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/tr&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/thead&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">dir</span> <span class="k">in</span> <span class="nx">dirs</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">           <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;{{ url_for(&#39;explore_path&#39;, uid=dir[&#39;uid&#39;]) }}&#34;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">dir</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/a&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/td&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;</span><span class="nx">directory</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;&lt;</span><span class="err">/td&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/tr&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">file</span> <span class="k">in</span> <span class="nx">files</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">file</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">file</span><span class="p">[</span><span class="s2">&#34;mime&#34;</span><span class="p">]</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">data</span><span class="o">-</span><span class="nx">order</span><span class="o">=</span><span class="s2">&#34;{{ file[&#39;stat&#39;].st_size }}&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;text-center&#34;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">file</span><span class="p">[</span><span class="s2">&#34;stat&#34;</span><span class="p">].</span><span class="nx">st_size</span><span class="o">|</span><span class="nx">filesizeformat</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/tr&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/tbody&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/table&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/div&gt; &lt;!-- tab-pane tables-view end --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/div&gt; &lt;!-- tab-content --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">endblock</span> <span class="nx">content</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">block</span> <span class="nx">js</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// On image error show a loading circle gif
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img&#34;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span> <span class="s2">&#34;{{ url_for(&#39;static&#39;, filename=config.REL_THEME_PATH +
</span></span></span><span class="line"><span class="cl"><span class="s2">                                                    &#39;thumb_loading.gif&#39;) }}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Datatables setup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">TABLES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;folder-contents&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">include</span> <span class="s2">&#34;tables.js&#34;</span> <span class="o">%</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Filter folder contents
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#filter-search&#34;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;input&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.small-box-footer&#34;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;.fm-item&#34;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">test</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">datatables</span><span class="p">[</span><span class="s2">&#34;folder-contents&#34;</span><span class="p">].</span><span class="nx">search</span><span class="p">(</span><span class="nx">value</span><span class="p">).</span><span class="nx">draw</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Initiate lightbox
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">lightbox</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.slb-item&#34;</span><span class="p">).</span><span class="nx">simpleLightbox</span><span class="p">({</span><span class="nx">captionSelector</span><span class="o">:</span> <span class="s2">&#34;self&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                             <span class="nx">captionType</span><span class="o">:</span><span class="s2">&#34;title&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                             <span class="nx">captionPosition</span><span class="o">:</span> <span class="s2">&#34;outside&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                             <span class="nx">alertError</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                             <span class="nx">docClose</span><span class="o">:</span> <span class="kc">false</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">check_thumb_jobs</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* It loads the new thumbnails when thumbnail jobs are finished. */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s2">&#34;{{ url_for(&#39;get_finished_thumbs&#39;) }}&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//console.log(ids);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">ids</span> <span class="o">===</span> <span class="s2">&#34;empty&#34;</span><span class="p">))</span> <span class="p">{</span>  <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">check_thumb_jobs</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#&#34;</span> <span class="o">+</span> <span class="nx">ids</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">       <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="s2">&#34;{{ url_for(&#39;static&#39;, filename=config.REL_THUMB_PATH) }}&#34;</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">             <span class="nx">ids</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="nx">ids</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34;.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Run check_thumb_jobs()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">check_thumb_jobs</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Shift + left mouse click on a file -&gt; Refresh its thumbnail.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.slb-item &gt; img&#34;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">     <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">     <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/refresh/&#34;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="o">%</span> <span class="nx">endblock</span> <span class="nx">js</span> <span class="o">%</span><span class="p">}</span></span></span></code></pre></div>

<h1 id="runningcode"><span lang="en">Running the app</span><span lang="el">Εκτέλεση της εφαρμογής μας</span></h1>

<p lang="en">Before starting the app, make sure you have a running Redis service, e.g. (depending on your system):</p>
<p lang="el">Πριν εκκινήσετε την εφαρμογή, βεβαιωθείτε ότι τρέχει η υπηρεσία Redis: π.χ. (εξαρτάται από το σύστημά σας):</p>

<div class="bg-black"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> sudo rc-service redis start
</span></span></code></pre></div></div>
<div class="bg-black"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> sudo systemctl start redis.service
</span></span></code></pre></div></div>

<h2 id="start-sh">./start.sh</h2>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Start 10 workers for thumbnailing</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>1..10<span class="o">}</span><span class="p">;</span> <span class="k">do</span> 
</span></span><span class="line"><span class="cl">  ./worker.py <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Trap to kill all the child processes (i.e. the workers) when the script terminates.</span>
</span></span><span class="line"><span class="cl"><span class="nb">trap</span> <span class="s2">&#34;trap - SIGTERM &amp;&amp; kill -- -</span><span class="nv">$$</span><span class="s2">&#34;</span> SIGINT SIGTERM EXIT
</span></span><span class="line"><span class="cl"><span class="c1"># Start our web app</span>
</span></span><span class="line"><span class="cl"><span class="nv">FLASK_APP</span><span class="o">=</span>fmsuite <span class="nv">FLASK_ENV</span><span class="o">=</span>development flask run</span></span></code></pre></div>

<h1 id="screenshots"><span lang="en">Screenshots</span><span lang="el">Στιγμιότυπα</span></h1>

<figure>
<img class="bordered centered" src="/images/webfilebrowser2.jpg" alt="Gallery view (files)" title="Gallery view (files)">
<figcaption lang="en" class="centered">Gallery view (files)</figcaption>
<figcaption lang="el" class="centered">Εκθεσιακή απεικόνιση (αρχεία)</figcaption>
</figure>

<div class="row">
<div class="col-sm-6"><figure>
<img src="/images/webfilebrowser1.jpg" alt="Gallery view (folders)" title="Gallery view (folders)">
<figcaption lang="en" class="centered">Gallery view (folders)</figcaption>
<figcaption lang="el" class="centered">Εκθεσιακή απεικόνιση (φάκελοι)</figcaption>
</figure></div>
<div class="col-sm-6"><figure>
<img src="/images/webfilebrowser3.jpg" alt="Table view" title="Table view">
<figcaption lang="en" class="centered">Table view</figcaption>
<figcaption lang="el" class="centered">Απεικόνιση πίνακα</figcaption>
</figure></div>
</div>

<p lang="en">In web design, a <i>lightbox</i> is an overlay that appears on top of a webpage, dimming the background in order to draw the attention to the content of the lightbox. For this project, I have modified <a href="https://github.com/andreknieriem/simplelightbox" target="_blank">SimpleLightbox</a> in order to support, besides viewing images, opening e-books and playing audio and video files in a lightbox.</p>
<p lang="el">Στον σχεδιασμό ιστοσελίδων, ονομάζουμε <i>lightbox (διαφανοσκόπειο)</i> μια επικάλυψη που εμφανίζεται πάνω από μια ιστοσελίδα, κάνωντας πιο αμυδρό το φόντο, ώστε να τραβήξει την προσοχή στα περιέχομενα του lightbox. Για αυτό το έργο, έχω τροποποιήσει το <a href="https://github.com/andreknieriem/simplelightbox" target="_blank">SimpleLightbox</a> ώστε να υποστηρίζει, εκτός από τη θέαση εικόνων, το άνοιγμα ηλεκτρονικών βιβλίων και το παίξιμο ήχων και βίντεο μέσα σε ένα lightbox.</p>

<div class="row">
<div class="col-sm-6"><figure>
<img src="/images/lightbox1.jpg" alt=">Reading an e-book (in a lightbox)" title=">Reading an e-book (in a lightbox)">
<figcaption lang="en" class="centered">Reading an e-book (in a lightbox)</figcaption>
<figcaption lang="el" class="centered">Διαβάζοντας ένα ηλεκτρονικό βιβλίο (σε lightbox)</figcaption>
</figure></div>
<div class="col-sm-6"><figure>
<img src="/images/lightbox2.jpg" alt="Watching a video (in a lightbox)" title="Watching a video (in a lightbox)">
<figcaption lang="en" class="centered">Watching a video (in a lightbox)</figcaption>
<figcaption lang="el" class="centered">Βλέπωντας ένα βίντεο (σε lightbox)</figcaption>
</figure></div>
</div>

<h1 id="fullcode"><span lang="en">Full code</span><span lang="el">Πλήρης κώδικας</span></h1>

<p lang="en">You can download the full code from here: <a href="https://github.com/Alamot/fmsuite" target="_blank">FM Suite</a></p>
<p lang="el">Μπορείτε να κατεβάσετε τον πλήρη κώδικα απο εδώ: <a href="https://github.com/Alamot/fmsuite" target="_blank">FM Suite</a></p> 

        </div>

        <aside>
          <div class="p-share centered">
            <a href="https://www.buymeacoffee.com/alamot" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-coffee"></i></a>
            <a href="http://www.facebook.com/sharer.php?src=bm&u=https%3a%2f%2falamot.github.io%2fweb_file_browser%2f&t=How%20to%20write%20your%20own%20Web%20File%20Browser" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-facebook"></i></a>
            <a lang="en" href="http://twitter.com/intent/tweet?url=https%3a%2f%2falamot.github.io%2fweb_file_browser%2f&text=How%20to%20write%20your%20own%20Web%20File%20Browser&tw_p=tweetbutton" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-twitter"></i></a>
            <a lang="el" href="http://twitter.com/intent/tweet?url=https%3a%2f%2falamot.github.io%2fweb_file_browser%2f&text=%ce%a0%cf%89%cf%82%20%ce%bd%ce%b1%20%ce%b3%cf%81%ce%ac%cf%88%ce%b5%cf%84%ce%b5%20%cf%84%ce%bf%ce%bd%20%ce%b4%ce%b9%ce%ba%cf%8c%20%cf%83%ce%b1%cf%82%20%ce%94%ce%b9%ce%b1%ce%b4%ce%b9%ce%ba%cf%84%cf%85%ce%b1%ce%ba%cf%8c%20%ce%a0%ce%b5%cf%81%ce%b9%ce%b7%ce%b3%ce%b7%cf%84%ce%ae%20%ce%91%cf%81%cf%87%ce%b5%ce%af%cf%89%ce%bd&tw_p=tweetbutton" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-twitter"></i></a>
            <a lang="en" href="http://pinterest.com/pin/create/link/?url==https%3a%2f%2falamot.github.io%2fweb_file_browser%2f&description=How%20to%20write%20your%20own%20Web%20File%20Browser&media=https://alamot.github.io/images/web_file_browser.jpg" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-pinterest-p"></i></a>
            <a lang="el" href="http://pinterest.com/pin/create/link/?url==https%3a%2f%2falamot.github.io%2fweb_file_browser%2f&description=%ce%a0%cf%89%cf%82%20%ce%bd%ce%b1%20%ce%b3%cf%81%ce%ac%cf%88%ce%b5%cf%84%ce%b5%20%cf%84%ce%bf%ce%bd%20%ce%b4%ce%b9%ce%ba%cf%8c%20%cf%83%ce%b1%cf%82%20%ce%94%ce%b9%ce%b1%ce%b4%ce%b9%ce%ba%cf%84%cf%85%ce%b1%ce%ba%cf%8c%20%ce%a0%ce%b5%cf%81%ce%b9%ce%b7%ce%b3%ce%b7%cf%84%ce%ae%20%ce%91%cf%81%cf%87%ce%b5%ce%af%cf%89%ce%bd&media=https://alamot.github.io/images/web_file_browser.jpg" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-pinterest-p"></i></a>
          </div>
        </aside>
      </article>
      
      <section id="posts-section">
        <header lang="en"><h3>See also...</h3></header>
        <header lang="el"><h3>Δείτε επίσης...</h3></header>
        <div>
          
          
          
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/epub_cover/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/openbook.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to read the cover image from an EPUB file in Python</h3>
      <h3 class="title" lang="el">Πως να διαβάσετε την εικόνα εξωφύλλου από ένα αρχείο EPUB σε Python</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">10 May 2020</time>
      <time lang="el">10 Μαϊ 2020</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/shutdown_manager_plain/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/shutdown_button.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Creation of a shutdown GUI using Gtk in Python</h3>
      <h3 class="title" lang="el">Δημιουργία μιας γραφικής διεπαφής κλεισίματος με τη χρήση Gtk σε Python</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">21 Jul 2016</time>
      <time lang="el">21 Ιουλ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/shutdown_manager_transparent/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/transparent_shutdown.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Creation of a transparent shutdown GUI using Gtk and Cairo in Python</h3>
      <h3 class="title" lang="el">Δημιουργία μιας διαφανούς γραφικής διεπαφής κλεισίματος με τη χρήση Gtk και Cairo σε Python</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">19 Sep 2016</time>
      <time lang="el">19 Σεπ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/opencl_fractals/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/fractals.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">OpenCL Fractals</h3>
      <h3 class="title" lang="el">OpenCL Κλασματομορφές (Φράκταλς)</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">07 Oct 2023</time>
      <time lang="el">07 Οκτ 2023</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/path_traversal_archiver/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/path.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Path-traversal archiver</h3>
      <h3 class="title" lang="el">Αρχειοθέτης με διάσχιση διαδρομής</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">14 May 2019</time>
      <time lang="el">14 Μαϊ 2019</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/test_encodings/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/encodings.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to determine the character encoding of a text file</h3>
      <h3 class="title" lang="el">Πως να αναγνωρίσετε την κωδικοποίηση χαρακτήρων ενός αρχείου κειμένου</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">21 Oct 2016</time>
      <time lang="el">21 Οκτ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/kivy_popup/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/kivy.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to build a responsive popup window with scrolling capability in Kivy</h3>
      <h3 class="title" lang="el">Πως να φτιάξετε ένα ευέλικτο αναδυόμενο παράθυρο με δυνατότητα κύλισης στην Kivy</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">19 Feb 2014</time>
      <time lang="el">19 Φεβ 2014</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/mssql_shell/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/dbs.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">MSSQL shell with file upload capability</h3>
      <h3 class="title" lang="el">MSSQL κέλυφος με δυνατότητα ανεβάσματος αρχείων</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">13 Apr 2018</time>
      <time lang="el">13 Απρ 2018</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/os_tasking/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/os4.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to write your own Operating System (x86_64): Multitasking</h3>
      <h3 class="title" lang="el">Πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64): Πολυδιεργασία</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">23 Apr 2022</time>
      <time lang="el">23 Απρ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/fast_commit_push/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/binary_flow.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Git &amp; Mercurial: How to commit-push fast and easily</h3>
      <h3 class="title" lang="el">Git &amp; Mercurial: Πως να κάνετε commit-push γρήγορα και εύκολα</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">17 Oct 2016</time>
      <time lang="el">17 Οκτ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/os_isr/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/os3.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to write your own Operating System (x86_64): Interrupts</h3>
      <h3 class="title" lang="el">Πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64): Διακοπές</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">21 Apr 2022</time>
      <time lang="el">21 Απρ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/sutherland_hodgman_algorithm/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/Sutherland_Hodgman_3D.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">3D visualization of Sutherland-Hodgman algorithm (polygon clipping)</h3>
      <h3 class="title" lang="el">Τρισδιάστατη οπτικοποίηση του αλγορίθμου Sutherland-Hodgman (αποκοπή πολυγώνων)</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">25 Apr 2016</time>
      <time lang="el">25 Απρ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/os_stage2/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/os2.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to write your own Operating System (x86_64): Bootloader, 2nd Stage (long mode)</h3>
      <h3 class="title" lang="el">Πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64): Εκκινητής, 2o Στάδιο (μακρά κατάσταση)</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">11 Apr 2022</time>
      <time lang="el">11 Απρ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/winrm_shell/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/winrm.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">WinRM shell (a.k.a. PowerShell Remoting) with file upload capability</h3>
      <h3 class="title" lang="el">WinRM κέλυφος (PowerShell Remoting) με δυνατότητα ανεβάσματος αρχείων</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">09 Apr 2018</time>
      <time lang="el">09 Απρ 2018</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/get_outlook_rules/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/flying_mail.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to collect Outlook rules using Powershell</h3>
      <h3 class="title" lang="el">Πως να συλλέξετε τους κανόνες του Outlook χρησιμοποιώντας Powershell</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">20 May 2022</time>
      <time lang="el">20 Μαϊ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/oracle/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/oracle.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Ask and you shall receive</h3>
      <h3 class="title" lang="el">Ζήτα και θα λάβεις</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">04 May 2019</time>
      <time lang="el">04 Μαϊ 2019</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/nl80211/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/wifi-sign.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to get info for the wireless interface using nl80211 in C</h3>
      <h3 class="title" lang="el">Πως να λάβετε πληροφορίες για την ασύρματη διεπαφή χρησιμοποιώντας την nl80211 στη C</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">09 Oct 2016</time>
      <time lang="el">09 Οκτ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/os_stage1/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/os1.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to write your own Operating System (x86_64): Bootloader, 1st Stage</h3>
      <h3 class="title" lang="el">Πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64): Εκκινητής, 1o Στάδιο</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">10 Apr 2022</time>
      <time lang="el">10 Απρ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
        </div>
      </section>
      
    </div>
   </div> 
  </div>


<footer class="l-footer">
<span class="copyleft">&copy;</span>
<span lang="en">&nbsp; Antonios Tsolis &nbsp; </span>
<span lang="el">&nbsp; Αντώνιος Τσώλης &nbsp; </span>
<script>
  function email(starting,server,firstname,lastname,subject,body,closing) {
    document.write(starting); document.write(lastname); document.write("." + firstname); document.write("@" + server);if (Boolean(subject)) { document.write("?subject=" + subject + "&body=" + body); }
    document.write(closing); }
  email("<a class='mymail' aria-label='Send me an email' href='mailto:", "gmail.com", "antonios", "tsolis", "", "","' target='_blank'><i class='fa fa-envelope-o' aria-hidden='true'></i></a>");
</script>
</footer>
<script async src="https://alamot.github.io/js/jq-btsp-lunr.min.js" onload="init()"></script>
<script>
short_months = {
  "en": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
  "el": ["Ιαν", "Φεβ", "Μαρ", "Απρ", "Μαϊ", "Ιουν", "Ιουλ", "Αυγ", "Σεπ", "Οκτ", "Νοε", "Δεκ"]
}
function init () {
$(document).ready(function(){
  $("#lang-selector>ul>li>a").click(function(){
    var langid = this.id;
    var selText = this.text;
    document.getElementById('mainbody').setAttribute('class', langid);
    document.getElementById('mainbody').setAttribute('lang', langid);
    localStorage.setItem('language', langid);
    $("#lang-selector>a").html(selText+' <i class="fa fa-caret-down" aria-hidden="true"></i>');
  });

  $("#TableOfContents a, #content-selector a").on('click', function(e) {
    var hash = this.hash;
    if (hash) {
      e.preventDefault();
      $('html, body').animate({scrollTop: $(hash).offset().top}, 1300, function(){
        window.location.hash = hash;
      });
    }  
  });

  
});}
</script>
<script>
(function(a){var b=function(b,h,n){function d(a){if(f.body)return a();setTimeout(function(){d(a)})}function k(){c.addEventListener&&c.removeEventListener("load",k);c.media=n||"all"}var f=a.document,c=f.createElement("link"),g;if(h)g=h;else{var e=(f.body||f.getElementsByTagName("head")[0]).childNodes;g=e[e.length-1]}var m=f.styleSheets;c.rel="stylesheet";c.href=b;c.media="only x";d(function(){g.parentNode.insertBefore(c,h?g:g.nextSibling)});var l=function(a){for(var b=c.href,d=m.length;d--;)if(m[d].href===
b)return a();setTimeout(function(){l(a)})};c.addEventListener&&c.addEventListener("load",k);c.onloadcssdefined=l;l(k);return c};"undefined"!==typeof exports?exports.loadCSS=b:a.loadCSS=b})("undefined"!==typeof global?global:this);
(function(a){if(a.loadCSS){var b=loadCSS.relpreload={};b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(h){return!1}};b.poly=function(){for(var b=a.document.getElementsByTagName("link"),e=0;e<b.length;e++){var d=b[e];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d),d.rel=null)}};if(!b.support()){b.poly();var e=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){a.clearInterval(e)});a.attachEvent&&
a.attachEvent("onload",function(){a.clearInterval(e)})}}})(this);
</script>
<script>
function labnolIframe(div) {
  var iframe = document.createElement('iframe');
  iframe.setAttribute('src', 'https://www.youtube.com/embed/' + div.dataset.id + '?autoplay=1');
  iframe.setAttribute('frameborder', '0');
  iframe.setAttribute('allowfullscreen', '1');
  iframe.setAttribute('allow', 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture');
  div.parentNode.replaceChild(iframe, div);
}

function initYouTubeVideos() {
  var playerElements = document.querySelectorAll('.youtube-player');
  for (var n = 0; n < playerElements.length; n++) {
    var videoId = playerElements[n].dataset.id;
    var div = document.createElement('div');
    div.setAttribute('data-id', videoId);
    var thumbNode = document.createElement('img');
    thumbNode.src = '//i.ytimg.com/vi/ID/hqdefault.jpg'.replace('ID', videoId);
    div.appendChild(thumbNode);
    var playButton = document.createElement('div');
    playButton.setAttribute('class', 'play');
    div.appendChild(playButton);
    div.onclick = function () {
      labnolIframe(this);
    };
    playerElements[n].appendChild(div);
  }
}

document.addEventListener('DOMContentLoaded', initYouTubeVideos);
</script>
</body>
</html>

