<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.99.1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<link rel="preload" href="https://alamot.github.io/css/noncrit.css" as="style" onload="this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://alamot.github.io/css/noncrit.css"></noscript>
<style>
button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}
*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}:before,:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}
input,button,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}
.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}
[role="button"]{cursor: pointer;}
.container{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}@media (min-width: 768px){.container{width:750px}}@media (min-width: 992px){.container{width:970px}}@media (min-width: 1200px){.container{width:1170px}}.container-fluid{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}.row{margin-left:-15px;margin-right:-15px}
.col-xs-1, .col-sm-1, .col-md-1, .col-lg-1, .col-xs-2, .col-sm-2, .col-md-2, .col-lg-2, .col-xs-3, .col-sm-3, .col-md-3, .col-lg-3, .col-xs-4, .col-sm-4, .col-md-4, .col-lg-4, .col-xs-5, .col-sm-5, .col-md-5, .col-lg-5, .col-xs-6, .col-sm-6, .col-md-6, .col-lg-6, .col-xs-7, .col-sm-7, .col-md-7, .col-lg-7, .col-xs-8, .col-sm-8, .col-md-8, .col-lg-8, .col-xs-9, .col-sm-9, .col-md-9, .col-lg-9, .col-xs-10, .col-sm-10, .col-md-10, .col-lg-10, .col-xs-11, .col-sm-11, .col-md-11, .col-lg-11, .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 { position: relative; min-height: 1px; padding-left: 15px; padding-right: 15px; }
@media (min-width: 768px){.col-sm-1,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-10,.col-sm-11,.col-sm-12{float:left}.col-sm-12{width:100%}.col-sm-11{width:91.66666667%}.col-sm-10{width:83.33333333%}.col-sm-9{width:75%}.col-sm-8{width:66.66666667%}.col-sm-7{width:58.33333333%}.col-sm-6{width:50%}.col-sm-5{width:41.66666667%}.col-sm-4{width:33.33333333%}.col-sm-3{width:25%}.col-sm-2{width:16.66666667%}.col-sm-1{width:8.33333333%}.col-sm-pull-12{right:100%}.col-sm-pull-11{right:91.66666667%}.col-sm-pull-10{right:83.33333333%}.col-sm-pull-9{right:75%}.col-sm-pull-8{right:66.66666667%}.col-sm-pull-7{right:58.33333333%}.col-sm-pull-6{right:50%}.col-sm-pull-5{right:41.66666667%}.col-sm-pull-4{right:33.33333333%}.col-sm-pull-3{right:25%}.col-sm-pull-2{right:16.66666667%}.col-sm-pull-1{right:8.33333333%}.col-sm-pull-0{right:auto}.col-sm-push-12{left:100%}.col-sm-push-11{left:91.66666667%}.col-sm-push-10{left:83.33333333%}.col-sm-push-9{left:75%}.col-sm-push-8{left:66.66666667%}.col-sm-push-7{left:58.33333333%}.col-sm-push-6{left:50%}.col-sm-push-5{left:41.66666667%}.col-sm-push-4{left:33.33333333%}.col-sm-push-3{left:25%}.col-sm-push-2{left:16.66666667%}.col-sm-push-1{left:8.33333333%}.col-sm-push-0{left:auto}.col-sm-offset-12{margin-left:100%}.col-sm-offset-11{margin-left:91.66666667%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-0{margin-left:0}}@media (min-width: 992px){.col-md-1,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-10,.col-md-11,.col-md-12{float:left}.col-md-12{width:100%}.col-md-11{width:91.66666667%}.col-md-10{width:83.33333333%}.col-md-9{width:75%}.col-md-8{width:66.66666667%}.col-md-7{width:58.33333333%}.col-md-6{width:50%}.col-md-5{width:41.66666667%}.col-md-4{width:33.33333333%}.col-md-3{width:25%}.col-md-2{width:16.66666667%}.col-md-1{width:8.33333333%}.col-md-pull-12{right:100%}.col-md-pull-11{right:91.66666667%}.col-md-pull-10{right:83.33333333%}.col-md-pull-9{right:75%}.col-md-pull-8{right:66.66666667%}.col-md-pull-7{right:58.33333333%}.col-md-pull-6{right:50%}.col-md-pull-5{right:41.66666667%}.col-md-pull-4{right:33.33333333%}.col-md-pull-3{right:25%}.col-md-pull-2{right:16.66666667%}.col-md-pull-1{right:8.33333333%}.col-md-pull-0{right:auto}.col-md-push-12{left:100%}.col-md-push-11{left:91.66666667%}.col-md-push-10{left:83.33333333%}.col-md-push-9{left:75%}.col-md-push-8{left:66.66666667%}.col-md-push-7{left:58.33333333%}.col-md-push-6{left:50%}.col-md-push-5{left:41.66666667%}.col-md-push-4{left:33.33333333%}.col-md-push-3{left:25%}.col-md-push-2{left:16.66666667%}.col-md-push-1{left:8.33333333%}.col-md-push-0{left:auto}.col-md-offset-12{margin-left:100%}.col-md-offset-11{margin-left:91.66666667%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-9{margin-left:75%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-6{margin-left:50%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-3{margin-left:25%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-0{margin-left:0}}
label { display: inline-block; max-width: 100%; margin-bottom: 5px; font-weight: bold; }
.btn{display:inline-block;margin-bottom:0;font-weight:400;text-align:center;vertical-align:middle;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;padding:6px 12px;font-size:16px;line-height:1.4;border-radius:4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.btn:focus,.btn:active:focus,.btn.active:focus,.btn.focus,.btn:active.focus,.btn.active.focus{outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}.btn:hover,.btn:focus,.btn.focus{color:#333;text-decoration:none}.btn:active,.btn.active{outline:0;background-image:none;-webkit-box-shadow:inset 0 3px 5px rgba(0,0,0,0.125);box-shadow:inset 0 3px 5px rgba(0,0,0,0.125)}.btn.disabled,.btn[disabled],fieldset[disabled] .btn{cursor:not-allowed;opacity:.65;filter:alpha(opacity=65);-webkit-box-shadow:none;box-shadow:none}a.btn.disabled,fieldset[disabled] a.btn{pointer-events:none}.btn-default{color:#333;background-color:#fff;border-color:#ccc}.btn-default:focus,.btn-default.focus{color:#333;background-color:#e6e6e6;border-color:#8c8c8c}.btn-default:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default:active,.btn-default.active,.open > .dropdown-toggle.btn-default{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default:active:hover,.btn-default.active:hover,.open > .dropdown-toggle.btn-default:hover,.btn-default:active:focus,.btn-default.active:focus,.open > .dropdown-toggle.btn-default:focus,.btn-default:active.focus,.btn-default.active.focus,.open > .dropdown-toggle.btn-default.focus{color:#333;background-color:#d4d4d4;border-color:#8c8c8c}.btn-default:active,.btn-default.active,.open > .dropdown-toggle.btn-default{background-image:none}.btn-default.disabled:hover,.btn-default[disabled]:hover,fieldset[disabled] .btn-default:hover,.btn-default.disabled:focus,.btn-default[disabled]:focus,fieldset[disabled] .btn-default:focus,.btn-default.disabled.focus,.btn-default[disabled].focus,fieldset[disabled] .btn-default.focus{background-color:#fff;border-color:#ccc}.btn-default .badge{color:#fff;background-color:#333}.btn-primary{color:#fff;background-color:#195eff;border-color:#004cff}.btn-primary:focus,.btn-primary.focus{color:#fff;background-color:#0045e5;border-color:#00267f}.btn-primary:hover{color:#fff;background-color:#0045e5;border-color:#003ac1}.btn-primary:active,.btn-primary.active,.open > .dropdown-toggle.btn-primary{color:#fff;background-color:#0045e5;border-color:#003ac1}.btn-primary:active:hover,.btn-primary.active:hover,.open > .dropdown-toggle.btn-primary:hover,.btn-primary:active:focus,.btn-primary.active:focus,.open > .dropdown-toggle.btn-primary:focus,.btn-primary:active.focus,.btn-primary.active.focus,.open > .dropdown-toggle.btn-primary.focus{color:#fff;background-color:#003ac1;border-color:#00267f}.btn-primary:active,.btn-primary.active,.open > .dropdown-toggle.btn-primary{background-image:none}.btn-primary.disabled:hover,.btn-primary[disabled]:hover,fieldset[disabled] .btn-primary:hover,.btn-primary.disabled:focus,.btn-primary[disabled]:focus,fieldset[disabled] .btn-primary:focus,.btn-primary.disabled.focus,.btn-primary[disabled].focus,fieldset[disabled] .btn-primary.focus{background-color:#195eff;border-color:#004cff}.btn-primary .badge{color:#195eff;background-color:#fff}.btn-success{color:#fff;background-color:#00bc16;border-color:#00a313}.btn-success:focus,.btn-success.focus{color:#fff;background-color:#008910;border-color:#002304}.btn-success:hover{color:#fff;background-color:#008910;border-color:#00650c}.btn-success:active,.btn-success.active,.open > .dropdown-toggle.btn-success{color:#fff;background-color:#008910;border-color:#00650c}.btn-success:active:hover,.btn-success.active:hover,.open > .dropdown-toggle.btn-success:hover,.btn-success:active:focus,.btn-success.active:focus,.open > .dropdown-toggle.btn-success:focus,.btn-success:active.focus,.btn-success.active.focus,.open > .dropdown-toggle.btn-success.focus{color:#fff;background-color:#00650c;border-color:#002304}.btn-success:active,.btn-success.active,.open > .dropdown-toggle.btn-success{background-image:none}.btn-success.disabled:hover,.btn-success[disabled]:hover,fieldset[disabled] .btn-success:hover,.btn-success.disabled:focus,.btn-success[disabled]:focus,fieldset[disabled] .btn-success:focus,.btn-success.disabled.focus,.btn-success[disabled].focus,fieldset[disabled] .btn-success.focus{background-color:#00bc16;border-color:#00a313}.btn-success .badge{color:#00bc16;background-color:#fff}.btn-info{color:#fff;background-color:#5bc0de;border-color:#46b8da}.btn-info:focus,.btn-info.focus{color:#fff;background-color:#31b0d5;border-color:#1b6d85}.btn-info:hover{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info:active,.btn-info.active,.open > .dropdown-toggle.btn-info{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info:active:hover,.btn-info.active:hover,.open > .dropdown-toggle.btn-info:hover,.btn-info:active:focus,.btn-info.active:focus,.open > .dropdown-toggle.btn-info:focus,.btn-info:active.focus,.btn-info.active.focus,.open > .dropdown-toggle.btn-info.focus{color:#fff;background-color:#269abc;border-color:#1b6d85}.btn-info:active,.btn-info.active,.open > .dropdown-toggle.btn-info{background-image:none}.btn-info.disabled:hover,.btn-info[disabled]:hover,fieldset[disabled] .btn-info:hover,.btn-info.disabled:focus,.btn-info[disabled]:focus,fieldset[disabled] .btn-info:focus,.btn-info.disabled.focus,.btn-info[disabled].focus,fieldset[disabled] .btn-info.focus{background-color:#5bc0de;border-color:#46b8da}.btn-info .badge{color:#5bc0de;background-color:#fff}.btn-warning{color:#fff;background-color:#f0ad4e;border-color:#eea236}.btn-warning:focus,.btn-warning.focus{color:#fff;background-color:#ec971f;border-color:#985f0d}.btn-warning:hover{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning:active,.btn-warning.active,.open > .dropdown-toggle.btn-warning{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning:active:hover,.btn-warning.active:hover,.open > .dropdown-toggle.btn-warning:hover,.btn-warning:active:focus,.btn-warning.active:focus,.open > .dropdown-toggle.btn-warning:focus,.btn-warning:active.focus,.btn-warning.active.focus,.open > .dropdown-toggle.btn-warning.focus{color:#fff;background-color:#d58512;border-color:#985f0d}.btn-warning:active,.btn-warning.active,.open > .dropdown-toggle.btn-warning{background-image:none}.btn-warning.disabled:hover,.btn-warning[disabled]:hover,fieldset[disabled] .btn-warning:hover,.btn-warning.disabled:focus,.btn-warning[disabled]:focus,fieldset[disabled] .btn-warning:focus,.btn-warning.disabled.focus,.btn-warning[disabled].focus,fieldset[disabled] .btn-warning.focus{background-color:#f0ad4e;border-color:#eea236}.btn-warning .badge{color:#f0ad4e;background-color:#fff}.btn-danger{color:#fff;background-color:#d9534f;border-color:#d43f3a}.btn-danger:focus,.btn-danger.focus{color:#fff;background-color:#c9302c;border-color:#761c19}.btn-danger:hover{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger:active,.btn-danger.active,.open > .dropdown-toggle.btn-danger{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger:active:hover,.btn-danger.active:hover,.open > .dropdown-toggle.btn-danger:hover,.btn-danger:active:focus,.btn-danger.active:focus,.open > .dropdown-toggle.btn-danger:focus,.btn-danger:active.focus,.btn-danger.active.focus,.open > .dropdown-toggle.btn-danger.focus{color:#fff;background-color:#ac2925;border-color:#761c19}.btn-danger:active,.btn-danger.active,.open > .dropdown-toggle.btn-danger{background-image:none}.btn-danger.disabled:hover,.btn-danger[disabled]:hover,fieldset[disabled] .btn-danger:hover,.btn-danger.disabled:focus,.btn-danger[disabled]:focus,fieldset[disabled] .btn-danger:focus,.btn-danger.disabled.focus,.btn-danger[disabled].focus,fieldset[disabled] .btn-danger.focus{background-color:#d9534f;border-color:#d43f3a}.btn-danger .badge{color:#d9534f;background-color:#fff}.btn-link{color:#000;font-weight:400;border-radius:0}.btn-link,.btn-link:active,.btn-link.active,.btn-link[disabled],fieldset[disabled] .btn-link{background-color:transparent;-webkit-box-shadow:none;box-shadow:none}.btn-link,.btn-link:hover,.btn-link:focus,.btn-link:active{border-color:transparent}.btn-link:hover,.btn-link:focus{color:#000;text-decoration:none;background-color:transparent}.btn-link[disabled]:hover,fieldset[disabled] .btn-link:hover,.btn-link[disabled]:focus,fieldset[disabled] .btn-link:focus{color:#777;text-decoration:none}.btn-lg{padding:10px 16px;font-size:20px;line-height:1.3333333;border-radius:6px}.btn-sm{padding:5px 10px;font-size:14px;line-height:1.5;border-radius:3px}.btn-xs{padding:1px 5px;font-size:14px;line-height:1.5;border-radius:3px}.btn-block{display:block;width:100%}.btn-block + .btn-block{margin-top:5px}
.dropup,.dropdown{position:relative}.dropdown-toggle:focus{outline:0}.dropdown-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:160px;padding:5px 0;margin:2px 0 0;list-style:none;font-size:16px;text-align:left;background-color:#fff;border:1px solid #ccc;border:1px solid rgba(0,0,0,0.15);border-radius:4px;-webkit-box-shadow:0 6px 12px rgba(0,0,0,0.175);box-shadow:0 6px 12px rgba(0,0,0,0.175);-webkit-background-clip:padding-box;background-clip:padding-box}.dropdown-menu.pull-right{right:0;left:auto}.dropdown-menu .divider{height:1px;margin:10px 0;overflow:hidden;background-color:#e5e5e5}.dropdown-menu > li > a{display:block;padding:3px 10px;clear:both;font-weight:400;line-height:1.4;color:#333;white-space:nowrap}.dropdown-menu > li > a:hover,.dropdown-menu > li > a:focus{text-decoration:none;color:#262626;background-color:#f5f5f5}.dropdown-menu > .active > a,.dropdown-menu > .active > a:hover,.dropdown-menu > .active > a:focus{color:#fff;text-decoration:none;outline:0;background-color:#195eff}.dropdown-menu > .disabled > a,.dropdown-menu > .disabled > a:hover,.dropdown-menu > .disabled > a:focus{color:#777}.dropdown-menu > .disabled > a:hover,.dropdown-menu > .disabled > a:focus{text-decoration:none;background-color:transparent;background-image:none;filter:progid:DXImageTransform.Microsoft.gradient(enabled = false);cursor:not-allowed}.open > .dropdown-menu{display:block}.open > a{outline:0}.dropdown-menu-right{left:auto;right:0}.dropdown-menu-left{left:0;right:auto}.dropdown-header{display:block;padding:3px 10px;font-size:14px;line-height:1.4;color:#777;white-space:nowrap}.dropdown-backdrop{position:fixed;left:0;right:0;bottom:0;top:0;z-index:990}.pull-right > .dropdown-menu{right:0;left:auto}.dropup .caret,.navbar-fixed-bottom .dropdown .caret{border-top:0;border-bottom:4px dashed;border-bottom:4px solid \9;content:""}.dropup .dropdown-menu,.navbar-fixed-bottom .dropdown .dropdown-menu{top:auto;bottom:100%;margin-bottom:2px}
.nav{margin-bottom:0;padding-left:0;list-style:none}.nav > li{position:relative;display:block}.nav > li > a{position:relative;display:block;padding:5px 10px}.nav > li > a:hover,.nav > li > a:focus{text-decoration:none;background-color:#a52a2a}.nav > li.disabled > a{color:#777}.nav > li.disabled > a:hover,.nav > li.disabled > a:focus{color:#777;text-decoration:none;background-color:transparent;cursor:not-allowed}.nav .open > a,.nav .open > a:hover,.nav .open > a:focus{background-color:#a52a2a;border-color:#000}.nav .nav-divider{height:1px;margin:10px 0;overflow:hidden;background-color:#e5e5e5}.nav > li > a > img{max-width:none}.nav-pills > li{float:left}.nav-pills > li > a{border-radius:4px}.nav-pills > li + li{margin-left:2px}.nav-pills > li.active > a,.nav-pills > li.active > a:hover,.nav-pills > li.active > a:focus{color:#fff;background-color:#195eff}.nav-stacked > li{float:none}.nav-stacked > li + li{margin-top:0px;margin-left:0}.navbar{position:relative;min-height:48px;max-height:48px;margin-bottom:22px;border:1px solid transparent}@media (min-width: 768px){.navbar{border-radius:4px}}@media (max-device-width: 480px) and (orientation: landscape){.navbar-fixed-top .navbar-collapse,.navbar-fixed-bottom .navbar-collapse{max-height:200px}}.navbar-static-top{z-index:1000;border-width:0 0 1px}@media (min-width: 768px){.navbar-static-top{border-radius:0}}.navbar-fixed-top,.navbar-fixed-bottom{position:fixed;right:0;left:0;z-index:1030}@media (min-width: 768px){.navbar-fixed-top,.navbar-fixed-bottom{border-radius:0}}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-fixed-bottom{bottom:0;margin-bottom:0;border-width:1px 0 0}@media (min-width: 768px){.navbar > .container .navbar-brand,.navbar > .container-fluid .navbar-brand{margin-left:-15px}}.navbar-fixed-bottom .navbar-nav > li > .dropdown-menu{margin-bottom:0;border-top-right-radius:4px;border-top-left-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.navbar-default{background-color:#7d1935;border-color:#611329}.navbar-default .navbar-nav > li > a{color:#fff}.navbar-default .navbar-nav > li > a:hover,.navbar-default .navbar-nav > li > a:focus{color:#fff;background-color:#a52a2a}.navbar-default .navbar-nav > .active > a,.navbar-default .navbar-nav > .active > a:hover,.navbar-default .navbar-nav > .active > a:focus{color:#fff;background-color:#611329}.navbar-default .navbar-nav > .disabled > a,.navbar-default .navbar-nav > .disabled > a:hover,.navbar-default .navbar-nav > .disabled > a:focus{color:#ccc;background-color:transparent}.navbar-default .navbar-toggle{border-color:#a52a2a}.navbar-default .navbar-toggle:hover,.navbar-default .navbar-toggle:focus{background-color:#a52a2a}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse,.navbar-default .navbar-form{border-color:#611329}.navbar-default .navbar-nav > .open > a,.navbar-default .navbar-nav > .open > a:hover,.navbar-default .navbar-nav > .open > a:focus{background-color:#611329;color:#fff}@media (max-width: 767px){.navbar-default .navbar-nav .open .dropdown-menu > li > a{color:#fff}.navbar-default .navbar-nav .open .dropdown-menu > li > a:hover,.navbar-default .navbar-nav .open .dropdown-menu > li > a:focus{color:#fff;background-color:#a52a2a}.navbar-default .navbar-nav .open .dropdown-menu > .active > a,.navbar-default .navbar-nav .open .dropdown-menu > .active > a:hover,.navbar-default .navbar-nav .open .dropdown-menu > .active > a:focus{color:#fff;background-color:#611329}.navbar-default .navbar-nav .open .dropdown-menu > .disabled > a,.navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:hover,.navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:focus{color:#ccc;background-color:transparent}}.navbar-default .navbar-link{color:#fff}.navbar-default .navbar-link:hover{color:#fff}.navbar-default .btn-link{color:#fff}.navbar-default .btn-link:hover,.navbar-default .btn-link:focus{color:#fff}
.label{display:inline;padding:.2em .6em .3em;font-size:75%;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em}a.label:hover,a.label:focus{color:#fff;text-decoration:none;cursor:pointer}.label:empty{display:none}.btn .label{position:relative;top:-1px}.label-default{background-color:#777}.label-default[href]:hover,.label-default[href]:focus{background-color:#5e5e5e}.label-primary{background-color:#195eff}.label-primary[href]:hover,.label-primary[href]:focus{background-color:#0045e5}.label-success{background-color:#00bc16}.label-success[href]:hover,.label-success[href]:focus{background-color:#008910}.label-info{background-color:#5bc0de}.label-info[href]:hover,.label-info[href]:focus{background-color:#31b0d5}.label-warning{background-color:#f0ad4e}.label-warning[href]:hover,.label-warning[href]:focus{background-color:#ec971f}.label-danger{background-color:#d9534f}.label-danger[href]:hover,.label-danger[href]:focus{background-color:#c9302c}.badge{display:inline-block;min-width:10px;padding:3px 7px;font-size:14px;font-weight:700;color:#fff;line-height:1;vertical-align:middle;white-space:nowrap;text-align:center;background-color:#000;border-radius:10px}.badge:empty{display:none}.btn .badge{position:relative;top:-1px}.btn-xs .badge,.btn-group-xs > .btn .badge{top:0;padding:1px 5px}a.badge:hover,a.badge:focus{color:#fff;text-decoration:none;cursor:pointer}
.nav-pills > .active > a > .badge{color:#000;background-color:#fff}.nav-pills > li > a > .badge{margin-left:3px}
.clearfix:before,.clearfix:after,.container:before,.container:after,.container-fluid:before,.container-fluid:after,.row:before,.row:after,.form-horizontal .form-group:before,.form-horizontal .form-group:after,.nav:before,.nav:after,.navbar:before,.navbar:after,.navbar-header:before,.navbar-header:after,.navbar-collapse:before,.navbar-collapse:after{content:" ";display:table}.clearfix:after,.container:after,.container-fluid:after,.row:after,.form-horizontal .form-group:after,.nav:after,.navbar:after,.navbar-header:after,.navbar-collapse:after{clear:both}
.pull-right { float: right !important; } .pull-left { float: left !important; }

 
html { font-size:16px; }
body:not(.en) :lang(en), body:not(.el) :lang(el), body:not(.fr) :lang(fr) { display: none; }
body {
  font-size: 16px; line-height: 1.45; color: #000000;  background-color: #eceff1;
  margin: 0; padding-top: 70px; 
  font-family: 'Open Sans', 'Times New Roman', sans-serif;
  -webkit-animation: bugfix infinite 1s;
}
@-webkit-keyframes bugfix { from { fill: 0; } to { fill: 0; } }

a { color: #000; word-wrap: break-word; text-decoration: none; }
a:hover, a:focus, a:active { color: black; text-decoration: none; }
a.label { box-shadow: 2px 3px 4px 0px rgba(0,0,0,0.75); }
figure {  display: table; margin: 10px auto; }
figure figcaption { caption-side: bottom; color: darkblue; display: table-caption;
font-size: 14px; margin-top: 5px; text-align:justify; }
h1, h2, h3, h4, h5, h6 { margin:0px; text-align: justify; }
img { max-width: 100%; }
img.bordered { border:1px solid #021a40;  border-radius:20px; box-shadow: 2px 3px 4px 0px rgba(0,0,0,0.75); }
li { line-height: 1.5rem; text-align:justify; }
p { text-align:justify; text-indent: 30px; }
section { margin-top: 1rem; margin-bottom: 1rem; }
section>header { margin-bottom: .3rem; }
ul, ol { padding-left: 1.5rem; }

article .image { background-size: cover; background-position: center; }
article time { font-size: .8rem; }
article.grid { max-width:384px; margin-bottom:0.5rem; height:26rem; overflow: hidden; }
article.grid .image { min-height: 12rem; }
article.grid footer { padding: 1rem; background-color: #ffffe6; }
article.grid .title { overflow: hidden; }
article.grid .summary { color: #333; font-size: .8rem; line-height: 1rem; max-height: 5rem; overflow: hidden; }
article.single { background-color: #fff; margin: 0 auto; padding-bottom: 1rem; max-width:1200px; }
article.single .image { max-width:786px; min-height: 24rem; margin-left:auto; margin-right:auto; }
article.single .body { margin-bottom: 2rem;  padding: 0 5rem; }
article.single .body a:not(.label) { color: #78909c; text-decoration: underline; }
article.single .body>h1, article.single .body>h2, article.single .body>h3 { padding-top: 60px; margin-top: -30px; margin-bottom: 0.5rem; }
article.single .body li {  margin: 0.5rem auto; }
article.li { margin-bottom: .5rem; font-size: .8rem; line-height: 1rem; }
article.li .cell { display:table-cell; vertical-align: middle; }
article.li .image { width: 4.1rem; height: 4.1rem; box-shadow: 2px 3px 4px 0px rgba(0,0,0,0.75); }
article.li footer { display:table-cell; vertical-align: middle; padding-left: .5rem;  }
article.li time { font-size: .7rem; }
article.li .title { font-size: 0.85rem; line-height: 1rem; font-weight: 700; }

.body .title { font-size: 2rem; line-height: 3rem; margin: 0.5rem auto; }
.label { display:inline-block; padding-top: 0.25rem; }

.navbar * { color: white !important; }
.navbar .dropdown-menu a:hover { background-color: brown; }
.nav>li>a:hover, .nav>li>a:focus { color: white; background-color: brown; }
.nav-pills { display: inline-block; margin: 0; }
.nav-pills>li.active>a { font-weight: 700 !important; background-color: #00bc16 !important; }
.nav-pills>li.active>a .badge { color: #00bc16; }
.cssdropdown { margin-top: 2rem; }
.cssdropdown input[type=checkbox], .cssdropdown ul { display: none; }
.cssdropdown label { font-size: 1.25rem; font-weight:700; min-width: 300px; }
.cssdropdown input[type=checkbox]:checked ~ ul { display: table-cell; }

.p-logo {
  font-family: 'Comic Sans MS', cursive; font-weight: bold; font-size: 2rem;
  text-shadow: 4px 2px 2px rgba(0,0,0,0.75);
  margin-top: 3px;
}
.l-footer * { color: white; }
.l-footer { background-color: #7D1935; padding: 0.75rem 0; text-align: center; }

.lgfont { font-size: 2rem; }
.margin-sm { margin: 0.5rem; }
.side-margins-1 { margin-left: 1rem !important; margin-right: 1rem !important; }
.side-margins-2 { margin-left: 2rem !important;; margin-right: 2rem !important; }
.margin-top-sm {  margin-top: 0.5rem; }
.topmargin5 {  margin-top: 5px; }
.topmargin7 { margin-top: 7px; }

#search-section, #results-section { display:none; }
#TableOfContents ul { list-style: none; }
#TableOfContents>ul {  padding-left: 0; font-weight: 700; }
#TableOfContents>ul ul { font-weight: normal; }

.summary { text-align:justify; }
.max-width640 { max-width: 640px; }
.floatleft { float:left; margin-right: 10px; }
.floatright { float:right; margin-left: 10px; }

.centered { margin-left: auto !important;  margin-right: auto !important; }
img.centered { display:block !important; }
div.centered, p.centered, figcaption.centered, nav.centered, table.centered, h1.centered, h2.centered, h3.centered { text-align:center !important; }

@media (max-width: 768px) {
  h1 { font-size: 1.4rem; line-height: 1.5rem; }
  h2 { font-size: 1.2rem; line-height: 1.5rem; }
  article.single .image { min-height: 12rem; }
  article.single .body pre { margin: 1rem -1rem; }
  article.single .body pre code { padding: 1rem 1rem; }
  article.single .body { padding: 0 1rem; }
  ul.scroll-menu { max-height: 250px; }
  .cssdropdown label, .nav-stacked>li>a { min-width: 240px; }
  .hidden768 { display:none; }
  .text-smaller {
    font-family: 'Open Sans', 'Times New Roman', sans-serif;
    font-size: 1rem;  font-weight: 700; letter-spacing: -1px;
    padding-left: 0px !important;  padding-right: 0px !important;
    line-height:32px;
  }
}
</style>
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://alamot.github.io/index.xml">

  <link href="https://alamot.github.io/index.xml" rel="alternate" type="application/rss+xml" title="The Portal of Knowledge" />


  <title>How to write your own Operating System (x86_64): Bootloader, 2nd Stage (long mode) - The Portal of Knowledge</title>
  <meta property='og:title' content="How to write your own Operating System (x86_64): Bootloader, 2nd Stage (long mode) - The Portal of Knowledge">
  <meta property="og:type" content="article">
  <meta name="description" content="A series of articles that provide guidance for writing your own Operating System (x86_64). Μια σειρά από άρθρα που παρέχουν οδηγίες για το πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64).">
  <meta property="og:description" content="A series of articles that provide guidance for writing your own Operating System (x86_64). Μια σειρά από άρθρα που παρέχουν οδηγίες για το πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64).">
  <meta property="og:image" content="https://alamot.github.io/images/os2.jpg">
  <meta property="og:image:width" content="768" />
  <meta property="og:image:height" content="384" />

<meta property="og:url" content="https://alamot.github.io/os_stage2/">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https:\/\/alamot.github.io\/"
    },
    "headline": "How to write your own Operating System (x86_64): Bootloader, 2nd Stage (long mode) |  ",
    "image": {
      "@type": "ImageObject",
      "url": "",
      "height": 700,
      "width": 700
    },
    "datePublished": "2022-04-11T00:00:00JST",
    "dateModified": "2022-04-11T00:00:00JST",
    "author": {
      "@type": "Person",
      "name": "Antonios Tsolis",
      "image": "https:\/\/alamot.github.io\/images/logo.png"
    },
    "publisher": {
      "@type": "Organization",
      "name": "",
      "logo": {
        "@type": "ImageObject",
        "url": "https:\/\/alamot.github.io\/images/logo.png",
        "height": 60,
        "width": 60
      }
    },
    "description": ""
  }
</script>
</head>
<body id="mainbody" class="en" lang="en">
<nav class="navbar navbar-default navbar-fixed-top centered">
<div class="container-fluid">
  
   <ul class="nav nav-pills pull-left topmargin7">
    <li id="content-selector" role="presentation" class="dropdown">
    <a class="dropdown-toggle btn-danger" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false"><span lang="en">Contents</span><span lang="el">Περιεχόμενα</span> <i class="fa fa-caret-down" aria-hidden="true"></i></a>
      <ul class="dropdown-menu scroll-menu">
        <li><a href="#title"><span lang="en">Start</span><span lang="el">Αρχή</span></a></li>
        
        
        
         
<li><a href="#intro"><span lang="en">Introduction</span><span lang="el">Εισαγωγή</span></a></li>
<li><a href="#stage2code"><span lang="en">Stage 2 code</span><span lang="el">Κώδικας του 2ου σταδίου</span></a>
<ul>
<li><a href="#stage2-bootstage2-asm">stage2/bootstage2.asm</a></li>
<li><a href="#stage2-a20-asm">stage2/a20.asm</a></li>
<li><a href="#stage2-paging-asm">stage2/paging.asm</a></li>
<li><a href="#stage2-pic-asm">stage2/pic.asm</a></li>
<li><a href="#stage2-longmode-asm">stage2/longmode.asm</a></li>
<li><a href="#kernel-kernel-asm">kernel/kernel.asm</a></li>
</ul></li>
<li><a href="#runningcode"><span lang="en">Running our code</span><span lang="el">Εκτέλεση του κώδικά μας</span></a></li>
<li><a href="#fullcode"><span lang="en">Full code</span><span lang="el">Πλήρης κώδικας</span></a></li>
<li><a href="#reference"><span lang="en">References</span><span lang="el">Αναφορές</span></a></li>
 
      
        <li><a href="#posts-section"><span lang="en">See also</span><span lang="el">Δείτε επίσης</span></a></li>
      </ul>
    </li>
   </ul>
  
   
  <ul class="nav nav-pills">
      <li><a class="p-logo" href="https://alamot.github.io/"><i class="fa fa-home" aria-hidden="true"></i> <span class="hidden768" lang="en">The Portal of Knowledge</span><span class="hidden768" lang="el">Η Πύλη της Γνώσης</span></a></li>
  </ul>
  
  <ul class="nav nav-pills pull-right topmargin7"> 
    <li id="lang-selector" role="presentation" class="dropdown">
      <a id="lang-index" class="dropdown-toggle btn-primary" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Language <i class="fa fa-caret-down" aria-hidden="true"></i></a>
      <ul class="dropdown-menu">
        <li><a id="en" href="#">English</a></li>
        <li><a id="el" href="#">Ελληνικά</a></li>
      </ul>
    </li>  
  </ul>
</div>
</nav>
<script>
langtext = "English";
language = localStorage.getItem('language');
if (language) {
  document.getElementById('mainbody').setAttribute('class', language);
  document.getElementById('mainbody').setAttribute('lang', language);
  if (language == 'el') { langtext="Ελληνικά"; }
  document.getElementById("lang-index").innerHTML=langtext+' <i class="fa fa-caret-down" aria-hidden="true"></i>';
}
</script>




<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <article class="single centered">
        <div class="image" style="background-image: url(https://alamot.github.io/images/os2.jpg);"></div>
        <div class="body">
            <header lang="en"><h1 id="title" class="title">How to write your own Operating System (x86_64): Bootloader, 2nd Stage (long mode)</h1></header>
            <header lang="el"><h1 class="title">Πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64): Εκκινητής, 2o Στάδιο (μακρά κατάσταση)</h1></header>
            <i class="fa fa-calendar topmargin7"  aria-hidden="true"></i>  
            <time lang="en" class="topmargin7">11 Apr 2022</time>
            <time lang="el" class="topmargin7">11 Απρ 2022</time>
            &middot; <i class="fa fa-folder-open-o topmargin7" aria-hidden="true"></i>
            
              <a class="label label-success topmargin7" href='https://alamot.github.io/categories/coding'>
                <span lang="en">Coding</span>
                <span lang="el">Προγραμματισμός</span>
              </a>
            
            &middot; <i class="fa fa-tags topmargin7" aria-hidden="true"></i>
            
              <a class="label label-primary topmargin7" href='https://alamot.github.io/tags/assembly'>
                <span lang="en">assembly</span>
                <span lang="el">assembly</span>
                </a>
            
              <a class="label label-primary topmargin7" href='https://alamot.github.io/tags/os'>
                <span lang="en">os</span>
                <span lang="el">λειτουργικό σύστημα</span>
                </a>
            
         
         <aside>
          <section>
            <header lang="en"><h2>Contents</h2></header>
            <header lang="el"><h2>Περιεχόμενα</h2></header>
            <div><nav id="TableOfContents">
<ul>
<li><a href="#intro"><span lang="en">Introduction</span><span lang="el">Εισαγωγή</span></a></li>
<li><a href="#stage2code"><span lang="en">Stage 2 code</span><span lang="el">Κώδικας του 2ου σταδίου</span></a>
<ul>
<li><a href="#stage2-bootstage2-asm">stage2/bootstage2.asm</a></li>
<li><a href="#stage2-a20-asm">stage2/a20.asm</a></li>
<li><a href="#stage2-paging-asm">stage2/paging.asm</a></li>
<li><a href="#stage2-pic-asm">stage2/pic.asm</a></li>
<li><a href="#stage2-longmode-asm">stage2/longmode.asm</a></li>
<li><a href="#kernel-kernel-asm">kernel/kernel.asm</a></li>
</ul></li>
<li><a href="#runningcode"><span lang="en">Running our code</span><span lang="el">Εκτέλεση του κώδικά μας</span></a></li>
<li><a href="#fullcode"><span lang="en">Full code</span><span lang="el">Πλήρης κώδικας</span></a></li>
<li><a href="#reference"><span lang="en">References</span><span lang="el">Αναφορές</span></a></li>
</ul>
</nav></div>
          </section>
         </aside>
        
        

<h1 id="intro"><span lang="en">Introduction</span><span lang="el">Εισαγωγή</span></h1>

<p lang="en">In our previous <a href="/os_stage1/">article</a>, we showed how to implement the first stage of the bootloader. Now, let's proceed to the second stage. First of all, in order for the execution to continue to the second stage, we have to remove the relevant comment from the jmp instruction in stage1/bootstage1.asm:</p>
<p lang="el">Σε προηγούμενο <a href="/os_stage1/">άρθρο</a> μας, δείξαμε πως υλοποιούμε το πρώτο στάδιο του εκκινητή. Εδώ, θα εξετάσουμε το δεύτερο στάδιο. Πρώτα από όλα, για να προχωρήσει η εκτέλεση στο δεύτερο στάδιο, πρέπει να αφαιρέσουμε το σχετικό σχόλιο από την εντολή jmp στο stage1/bootstage1.asm:</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl">    <span class="nf">...</span>
</span></span><span class="line"><span class="cl">    <span class="c1">; Jump to the entry point of stage 2</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jmp</span> <span class="nv">Stage2_entrypoint</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">...</span></span></span></code></pre></div>

<h1 id="stage2code"><span lang="en">Stage 2 code</span><span lang="el">Κώδικας του 2ου σταδίου</span></h1>

<p lang="en">In the x86_64 computer architecture, <strong>long mode</strong> is the architecture's intended primary mode of operation, where a 64-bit operating system can access 64-bit instructions and registers. Let's see some things we need in order to enter the long mode:</p>
<ol lang="en">
<li>We check if the long mode is supported.</li>
<li>We activate the A20 gate / address line.</li>
<li>We prepare the memory paging.</li>
<li>We remap the PIC (Programmable Interrupt Controller).</li>
<li>Then, we enter the long mode and pass the control to the Kernel.</li>
</ol>
<p lang="en">Let's examine the code for the second stage:</p>

<p lang="el">Στην αρχιτεκτονική υπολογιστών x86_64, η προορισμένη κατάσταση λειτουργίας είναι η λεγόμενη μακρά κατάσταση (<strong>long mode</strong>) όπου ενα 64-bit λειτουργικό σύστημα έχει πρόσβαση στις 64-bit εντολές και τους 64-bit καταχωρητές. Ας δούμε τι χρειάζεται να κάνουμε ώστε να μπούμε στην λειτουργία μακράς κατάστασης:</p>
<ol lang="el">
<li>Ελέγχουμε αν η λειτουργία μακράς κατάστασης υποστηρίζεται.</li>
<li>Ενεργοποιούμε την πύλη / γραμμή διεύθυνσης A20.</li>
<li>Προετοιμάζομε τη σελιδοποίηση της μνήμης.</li>
<li>Επανακαθορίζουμε τον Προγραμματιζόμενο Ελεγκτή Διακοπών (PIC).</li>
<li>Τέλος, εισερχόμαστε στη λειτουργία μακράς κατάστασης και δίνουμε τον έλεγχο στον Πυρήνα.</li>
</ol>
<p lang="el">Ας δούμε, λοιπόν, τον κώδικα για το δεύτερο στάδιο:</p>

<h2 id="stage2-bootstage2-asm">stage2/bootstage2.asm</h2>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="k">BITS</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Initialized data------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nf">stage2_message</span> <span class="nv">dw</span> <span class="mi">19</span>
</span></span><span class="line"><span class="cl"><span class="kd">db</span> <span class="s">&#39;Entering Stage 2...&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">longmode_supported_message</span> <span class="nv">dw</span> <span class="mi">23</span>
</span></span><span class="line"><span class="cl"><span class="kd">db</span> <span class="s">&#39;Long mode is supported.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">longmode_not_supported_message</span> <span class="nv">dw</span> <span class="mi">27</span>
</span></span><span class="line"><span class="cl"><span class="kd">db</span> <span class="s">&#39;Long mode is not supported.&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Code------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nl">Stage2_entrypoint:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">; Print &#39;Entering Stage 2...&#39; message</span>
</span></span><span class="line"><span class="cl">      <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="nv">stage2_message</span>
</span></span><span class="line"><span class="cl">      <span class="nf">call</span> <span class="nv">Real_mode_println</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">; Check if long mode is supported</span>
</span></span><span class="line"><span class="cl">      <span class="nf">call</span> <span class="nv">Is_longmode_supported</span>
</span></span><span class="line"><span class="cl">      <span class="nf">test</span> <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>
</span></span><span class="line"><span class="cl">      <span class="nf">jz</span> <span class="nv">.long_mode_not_supported</span>
</span></span><span class="line"><span class="cl">      <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="nv">longmode_supported_message</span>
</span></span><span class="line"><span class="cl">      <span class="nf">call</span> <span class="nv">Real_mode_println</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">; Enable Gate A20</span>
</span></span><span class="line"><span class="cl">      <span class="nf">call</span> <span class="nv">Enable_A20</span>
</span></span><span class="line"><span class="cl">      <span class="c1">; Prepare paging  </span>
</span></span><span class="line"><span class="cl">      <span class="nf">call</span> <span class="nv">Prepare_paging</span>
</span></span><span class="line"><span class="cl">      <span class="c1">; Remap PIC</span>
</span></span><span class="line"><span class="cl">      <span class="nf">call</span> <span class="nv">Remap_PIC</span>
</span></span><span class="line"><span class="cl">      <span class="c1">; Enter long mode</span>
</span></span><span class="line"><span class="cl">      <span class="nf">call</span> <span class="nv">Enter_long_mode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="nl">.long_mode_not_supported:</span>
</span></span><span class="line"><span class="cl">        <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="nv">longmode_not_supported_message</span>
</span></span><span class="line"><span class="cl">        <span class="nf">call</span> <span class="nv">Real_mode_println</span>
</span></span><span class="line"><span class="cl">       <span class="nl">.halt:</span> <span class="nf">hlt</span> <span class="c1">; Infinite loop. </span>
</span></span><span class="line"><span class="cl">        <span class="nf">jmp</span> <span class="nv">.halt</span> <span class="c1">; (It prevents us from going off in memory and executing junk).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">; Include</span>
</span></span><span class="line"><span class="cl"><span class="cp">%include &#34;stage2/a20.asm&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp">%include &#34;stage2/paging.asm&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp">%include &#34;stage2/pic.asm&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp">%include &#34;stage2/longmode.asm&#34;</span></span></span></code></pre></div>

<h2 id="stage2-a20-asm">stage2/a20.asm</h2>

<p lang="en">When IBM PC AT was released in 1984 (designed around the Intel 80286 microprocessor), for the sake of backward compatibility, a quirk in the 8086 microprocessor architecture (a memory wraparound) had to be replicated. You can read more about this issue <a href="https://en.wikipedia.org/wiki/A20_line">here</a>. Thus, the A20 line on the address bus was (and still is in many systems) disabled by default. This means that if we want to gain access to the full memory range, we have to enable the A20 line. There are several different ways (that may or may not be supported) and some of them may cause problems on some computers. Therefore, the recommended method is to try all of them, in the order of least risk, until one works:</p>
<ol lang="en">
<li>We test if A20 is already enabled. If it is, we don't need to do anything at all.</li>
<li>We try to enable A20 using the BIOS function (we ignore the returned status).</li>
<li>We test if A20 is enabled (to see if the BIOS function actually worked or not).</li>
<li>We try to enable A20 using the keyboard controller method.</li>
<li>We test if A20 is enabled in a loop with a time-out (as the keyboard controller method may work slowly).</li>
<li>We try to enable A20 using the "Fast A20" method last.</li>
<li>We test if A20 is enabled in a loop with a time-out (as the "Fast A20" method may work slowly).</li>
<li>If none of the above worked, we give up.</li>
</ol>

<p lang="el">Το 1984 κυκλοφόρησε ο IBM PC AT, σχεδιασμένος γύρω από τον μικροεπεξεργαστη 80286 της Intel. Για χάρη της προς τα πίσω συμβατότητας, μια ιδιοτροπία στην αρχιτεκτονική του μικροεπεξεργαστή 8086 (μια κυκλική επικάλυψη στην πρόσβαση της μνήμης) έπρεπε να αναπαραχθεί και σε αυτόν. Μπορείτε να διαβάσετε περισσότερα για αυτό το θέμα <a href="https://en.wikipedia.org/wiki/A20_line">εδώ</a>. Η ουσία είναι ότι η γραμμή Α20 στο δίαυλο διευθύνσεων ήταν (και εξακολουθεί να είναι σε πολλά συστήματα) αρχικά απενεργοποιημένη. Αυτό σημαίνει ότι αν θέλουμε να αποκτήσουμε πρόσβαση στο πλήρες εύρος της μνήνης, πρέπει να ενεργοποιήσουμε τη γραμμή Α20. Υπάρχουν αρκετοί διαφορετικοί τρόποι για να το επιτύχουμε αυτό (που μπορει να υποστηρίζονται ή όχι) και κάποιοι από αυτούς μπορεί να δημιουργήσουν προβλήματα σε κάποια συστήματα. Ως εκ τούτου, η συνιστώμενη μέθοδος είναι να δοκιμάσουμε όλους τους τρόπους κατά σειρά αυξανόμενου ρίσκου, μέχρι κάποιος να δουλέψει:</p>
<ol lang="el">
<li>Ελέγχουμε αν η A20 είναι ήδη ενεργοποιημένη. Αν είναι, δε χρειάζεται να κάνουμε κάτι άλλο.</li>
<li>Δοκιμάζουμε να ενεργοποιήσουμε την Α20, χρησιμοποιώντας τη λειτουργία του BIOS (αγνοούμε την τιμή που μας γυρίζει).</li>
<li>Ελέγχουμε αν η A20 ενεργοποιήθηκε (για να δούμε αν η λειτουργία του BIOS δούλεψε στην πράξη ή όχι).</li>
<li>Δοκιμάζουμε να ενεργοποιήσουμε την Α20, χρησιμοποιώντας τον ελεκτή του πληκτρολογίου.</li>
<li>Ελέγχουμε αν η A20 ενεργοποιήθηκε σε ένα βρόχο με κάποιο χρονικό τέλος (μιας και η μέθοδος με τον ελεκτή του πληκτρολογίου μπορεί να πάρει κάποιο χρόνο για να δουλέψει).</li>
<li>Δοκιμάζουμε να ενεργοποιήσουμε την Α20, χρησιμοποιώντας τη μέθοδο "Fast A20" τελευταία.</li>
<li>Ελέγχουμε αν η A20 ενεργοποιήθηκε σε ένα βρόχο με κάποιο χρονικό τέλος (μιας και η μέθοδος "Fast A20" μπορεί να πάρει κάποιο χρόνο για να δουλέψει).</li>
<li>Αν δε δούλεψε κανένα από τα παραπάνω, τα παρατάμε.</li>
</ol>
<p></p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="k">BITS</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Initialized data------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nf">a20_enabled_message</span> <span class="nv">dw</span> <span class="mi">15</span>
</span></span><span class="line"><span class="cl"><span class="kd">db</span> <span class="s">&#39;A20 is enabled.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">a20_disabled_message</span> <span class="nv">dw</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl"><span class="kd">db</span> <span class="s">&#39;A20 is disabled.&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="nf">a20_trying_bios</span> <span class="nv">dw</span> <span class="mi">34</span>
</span></span><span class="line"><span class="cl"><span class="kd">db</span> <span class="s">&#39;Trying to enable A20 using BIOS...&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">a20_trying_keyb</span> <span class="nv">dw</span> <span class="mi">49</span>
</span></span><span class="line"><span class="cl"><span class="kd">db</span> <span class="s">&#39;Trying to enable A20 using Keyboard Controller...&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">a20_trying_io92</span> <span class="nv">dw</span> <span class="mi">40</span>
</span></span><span class="line"><span class="cl"><span class="kd">db</span> <span class="s">&#39;Trying to enable A20 using IO port 92...&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Code------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nl">Enable_A20:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nb">Ch</span><span class="nv">eck_A20</span> <span class="c1">; Check if A20 is already enabled.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span> <span class="nb">ax</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; Try to enable A20 using BIOS.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="nv">a20_trying_bios</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">Real_mode_println</span>  
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">Enable_A20_using_BIOS</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nb">Ch</span><span class="nv">eck_A20</span> <span class="c1">; Check if A20 is enabled.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span> <span class="nb">ax</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; Try to enable A20 using eEyboard Controller.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="nv">a20_trying_keyb</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">Real_mode_println</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">Enable_A20_using_Keyboard_Controller</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nb">Ch</span><span class="nv">eck_A20</span> <span class="c1">; Check if A20 is enabled.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span> <span class="nb">ax</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; Try to enable A20 using IO port 92h (Fast A20 method).</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="nv">a20_trying_io92</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">Real_mode_println</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">Enable_A20_using_Keyboard_Controller</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nb">Ch</span><span class="nv">eck_A20</span> <span class="c1">; Check if A20 is enabled.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span> <span class="nb">ax</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.end</span>
</span></span><span class="line"><span class="cl">   <span class="nl">.halt:</span> <span class="nf">hlt</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">jmp</span> <span class="nv">.halt</span> <span class="c1">; Infinite loop.</span>
</span></span><span class="line"><span class="cl">   <span class="nl">.end:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">Check_A20:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;********************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Check the status of the A20 line                                   ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;********************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">Real_mode_check_A20</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span> <span class="nb">ax</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.a20_enabled</span>
</span></span><span class="line"><span class="cl">        <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="nv">a20_disabled_message</span>
</span></span><span class="line"><span class="cl">        <span class="nf">call</span> <span class="nv">Real_mode_println</span>
</span></span><span class="line"><span class="cl">        <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">   <span class="nl">.a20_enabled:</span>
</span></span><span class="line"><span class="cl">        <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="nv">a20_enabled_message</span>
</span></span><span class="line"><span class="cl">        <span class="nf">call</span> <span class="nv">Real_mode_println</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">Real_mode_check_A20:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;**************************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Check the status of the A20 line (in real mode)                          ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;--------------------------------------------------------------------------;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Returns: ax = 0 if the a20 line is disabled (memory wraps around)        ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;          ax = 1 if the a20 line is enabled (memory does not wrap around) ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;**************************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pushf</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">ds</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">es</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">di</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">si</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cli</span> <span class="c1">; clear interrupts</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">xor</span> <span class="nb">ax</span><span class="p">,</span> <span class="nb">ax</span> <span class="c1">; ax = 0</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">es</span><span class="p">,</span> <span class="nb">ax</span> <span class="c1">; es = 0</span>
</span></span><span class="line"><span class="cl">    <span class="nf">not</span> <span class="nb">ax</span>     <span class="c1">; ax = 0xFFFF</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ds</span><span class="p">,</span> <span class="nb">ax</span> <span class="c1">; ds = 0xFFFF</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">di</span><span class="p">,</span> <span class="mh">0x0500</span> <span class="c1">; 0500 and 0510 are chosen since they are guaranteed to be free </span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">si</span><span class="p">,</span> <span class="mh">0x0510</span> <span class="c1">; for use at any point of time after BIOS initialization.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; save the original values found at these addresses.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">dl</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">dx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">dl</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nb">ds</span><span class="p">:</span><span class="nb">si</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">dx</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span><span class="p">],</span> <span class="mh">0x00</span> <span class="c1">; [es:di] is 0:0500</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nb">ds</span><span class="p">:</span><span class="nb">si</span><span class="p">],</span> <span class="mh">0xFF</span> <span class="c1">; [ds:si] is FFFF:0510 </span>
</span></span><span class="line"><span class="cl">    <span class="nf">cmp</span> <span class="kt">byte</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span><span class="p">],</span> <span class="mh">0xFF</span> <span class="c1">; if the A20 line is disabled, [es:di] will contain 0xFF</span>
</span></span><span class="line"><span class="cl">                           <span class="c1">; (as the write to [ds:si] really occured to 00500).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span> <span class="mi">0</span> <span class="c1">; A20 disabled ([es:di] equal to 0xFF).</span>
</span></span><span class="line"><span class="cl">    <span class="nf">je</span> <span class="nv">.a20_disabled</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span> <span class="mi">1</span> <span class="c1">; A20 enabled.</span>
</span></span><span class="line"><span class="cl">   <span class="nl">.a20_disabled:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; restore original values</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">dx</span>  
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nb">ds</span><span class="p">:</span><span class="nb">si</span><span class="p">],</span> <span class="nb">dl</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">dx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span><span class="p">],</span> <span class="nb">dl</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">si</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">di</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">es</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">ds</span>
</span></span><span class="line"><span class="cl">    <span class="nf">popf</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sti</span> <span class="c1">; Enable interrupts.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">Enable_A20_using_BIOS:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;*************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Try to enable A20 gate using the BIOS (int 15h, ax = 2401h) ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;-------------------------------------------------------------;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Returns: ax = 0 (Failure)                                   ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;          ax = 1 (Success)                                   ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;*************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span><span class="mh">2403h</span>  <span class="c1">; Query A20 gate Support (later PS/2s systems)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">int</span> <span class="mh">15h</span>     
</span></span><span class="line"><span class="cl">    <span class="nf">jb</span> <span class="nv">.failure</span>   <span class="c1">; INT 15h is not supported                </span>
</span></span><span class="line"><span class="cl">    <span class="nf">cmp</span> <span class="nb">ah</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.failure</span>  <span class="c1">; INT 15h is not supported</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span> <span class="mh">2402h</span> <span class="c1">; Get A20 gate Status</span>
</span></span><span class="line"><span class="cl">    <span class="nf">int</span> <span class="mh">15h</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jb</span> <span class="nv">.failure</span>   <span class="c1">; Couldn&#39;t get status</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cmp</span> <span class="nb">ah</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.failure</span>  <span class="c1">; Couldn&#39;t get status</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cmp</span> <span class="nb">al</span><span class="p">,</span> <span class="mi">1</span>     
</span></span><span class="line"><span class="cl">    <span class="nf">jz</span> <span class="nv">.success</span>   <span class="c1">; A20 is already activated</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span> <span class="mh">2401h</span> <span class="c1">; Enable A20 gate </span>
</span></span><span class="line"><span class="cl">    <span class="nf">int</span> <span class="mh">15h</span>     
</span></span><span class="line"><span class="cl">    <span class="nf">jb</span> <span class="nv">.failure</span>   <span class="c1">; Couldn&#39;t enable the A20 gate</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cmp</span> <span class="nb">ah</span><span class="p">,</span> <span class="mi">0</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.failure</span>  <span class="c1">; Couldn&#39;t enable the A20 gate</span>
</span></span><span class="line"><span class="cl">   <span class="nl">.success:</span>
</span></span><span class="line"><span class="cl">        <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">   <span class="nl">.failure:</span>
</span></span><span class="line"><span class="cl">        <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">Disable_A20_using_BIOS:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;**************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Try to disable A20 gate using the BIOS (int 15h, ax = 2400h) ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;**************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span> <span class="mh">2400h</span>
</span></span><span class="line"><span class="cl">    <span class="nf">int</span> <span class="mh">15h</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">Enable_A20_using_Keyboard_Controller:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;******************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Try to enable A20 line using the Keyboard Controller (chip 8042) ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;------------------------------------------------------------------;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Returns: ax = 0 (Failure)                                        ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;          ax = 1 (Success)                                        ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;******************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cli</span>           <span class="c1">; Clear interrupts.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">a20wait</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0xAD</span>  <span class="c1">; Disable keyboard.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="mh">0x64</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">a20wait</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0xD0</span>  <span class="c1">; Read from input.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="mh">0x64</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">a20wait2</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">in</span> <span class="nb">al</span><span class="p">,</span><span class="mh">0x60</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">eax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">a20wait</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0xD1</span>  <span class="c1">; Write to output.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="mh">0x64</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">a20wait</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">eax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">or</span> <span class="nb">al</span><span class="p">,</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="mh">0x60</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">a20wait</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0xAE</span>  <span class="c1">; Enable keyboard.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="mh">0x64</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">call</span> <span class="nv">a20wait</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sti</span>           <span class="c1">; Enables interrupts.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">a20wait:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">in</span>      <span class="nb">al</span><span class="p">,</span> <span class="mh">0x64</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span>    <span class="nb">al</span><span class="p">,</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span>     <span class="nv">a20wait</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">a20wait2:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">in</span>      <span class="nb">al</span><span class="p">,</span> <span class="mh">0x64</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span>    <span class="nb">al</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jz</span>      <span class="nv">a20wait2</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;*********************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Enable A20 Line via IO port 92h (Fast A20 method)                   ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;---------------------------------------------------------------------;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; This method is quite dangerous because it may cause conflicts with  ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; some hardware devices forcing the system to halt.                   ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;=====================================================================;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Bits of port 92h                                                    ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;---------------------------------------------------------------------;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Bit 0 - Setting to 1 causes a fast reset                            ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Bit 1 - 0: disable A20, 1: enable A20                               ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Bit 2 - Manufacturer defined                                        ;      </span>
</span></span><span class="line"><span class="cl"><span class="c1">; Bit 3 - power on password bytes. 0: accessible, 1: inaccessible     ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Bits 4-5 - Manufacturer defined                                     ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Bits 6-7 - 00: HDD activity LED off, 01 or any value is &#34;on&#34;        ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;*********************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="nl">Enable_A20_using_IO_port_92:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">in</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0x92</span>  <span class="c1">; Read from port 0x92</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span> <span class="nb">al</span><span class="p">,</span> <span class="mi">2</span>   <span class="c1">; Check if bit 1 (i.e. the 2nd bit) is set.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jnz</span> <span class="nv">.end</span>     <span class="c1">; If bit 1 (i.e. the 2nd bit) is already set don&#39;t do anything.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">or</span> <span class="nb">al</span><span class="p">,</span> <span class="mi">2</span>     <span class="c1">; Activate bit 1 (i.e. the 2nd bit).</span>
</span></span><span class="line"><span class="cl">    <span class="nf">and</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0xFE</span> <span class="c1">; Make sure bit 0 is 0 (it causes a fast reset).</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="mh">0x92</span><span class="p">,</span> <span class="nb">al</span> <span class="c1">; Write to port 0x92</span>
</span></span><span class="line"><span class="cl">   <span class="nl">.end:</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span></span></span></code></pre></div>

<h2 id="stage2-paging-asm">stage2/paging.asm</h2>

<p lang="en">Here is the code that sets the memory paging:</p>
<p lang="el">Εδώ είναι ο κώδικας που καθορίζει τη σελιδοποίηση της μνήμης:</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="k">BITS</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Define----------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="cp">%define PAGE_PRESENT (1 &lt;&lt; 0)
</span></span></span><span class="line"><span class="cl"><span class="cp">%define PAGE_WRITE   (1 &lt;&lt; 1)
</span></span></span><span class="line"><span class="cl"><span class="cp">%define CODE_SEG      0x0008
</span></span></span><span class="line"><span class="cl"><span class="cp">%define PAGING_DATA   0x9000
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">;---Initialized data------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;****************************************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Global Descriptor Table (GDT)                                                          ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;****************************************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; The Global Descriptor Table (GDT) is a data structure used by x86-family processors    ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; (starting with the 80286) in order to define the characteristics of the various memory ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; areas (segments) used during program execution, including the base address, the size,  ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; and access privileges like executability and writability.                              ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;****************************************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="nl">GDT:</span>
</span></span><span class="line"><span class="cl">  <span class="nl">.Null:</span>
</span></span><span class="line"><span class="cl">    <span class="kd">dq</span> <span class="mh">0x0000000000000000</span>  <span class="c1">; Null Descriptor (should be present).</span>
</span></span><span class="line"><span class="cl">  <span class="nl">.Code:</span>
</span></span><span class="line"><span class="cl">    <span class="kd">dq</span> <span class="mh">0x00209A0000000000</span>  <span class="c1">; 64-bit code descriptor (exec/read).</span>
</span></span><span class="line"><span class="cl">    <span class="kd">dq</span> <span class="mh">0x0000920000000000</span>  <span class="c1">; 64-bit data descriptor (read/write).</span>
</span></span><span class="line"><span class="cl">  <span class="k">ALIGN</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="kd">dw</span> <span class="mi">0</span>                   <span class="c1">; Padding (to make the &#34;address of the GDT&#34; field aligned on a 4-byte boundary).</span>
</span></span><span class="line"><span class="cl">  <span class="nl">.Pointer:</span>
</span></span><span class="line"><span class="cl">    <span class="kd">dw</span> <span class="kc">$</span> <span class="o">-</span> <span class="nv">GDT</span> <span class="o">-</span> <span class="mi">1</span>         <span class="c1">; 16-bit Size (Limit) of GDT.</span>
</span></span><span class="line"><span class="cl">    <span class="kd">dd</span> <span class="nv">GDT</span>                 <span class="c1">; 32-bit Base Address of GDT. (CPU will zero extend to 64-bit)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Code------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nl">Prepare_paging:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;*******************************************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Prepare paging                                                                            ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;-------------------------------------------------------------------------------------------;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; ES:EDI Should point to a valid page-aligned 16KiB buffer, for the PML4, PDPT, PD and a PT.;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; SS:ESP Should point to memory that can be used as a small (1 uint32_t) stack.             ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;*******************************************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edi</span><span class="p">,</span> <span class="nv">PAGING_DATA</span> <span class="c1">; Point edi to a free space to create the paging structures.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; Zero out the 16KiB buffer. Since we are doing a rep stosd, count should be bytes/4.   </span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">di</span>         <span class="c1">; REP STOSD alters DI.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mh">0x1000</span>
</span></span><span class="line"><span class="cl">    <span class="nf">xor</span> <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cld</span>
</span></span><span class="line"><span class="cl">    <span class="nf">rep</span> <span class="nv">stosd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">di</span>          <span class="c1">; Get DI back.</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">; Build the Page Map Level 4. ES:DI points to the Page Map Level 4 table.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">lea</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span> <span class="o">+</span> <span class="mh">0x1000</span><span class="p">]</span>         <span class="c1">; EAX = Address of the Page Directory Pointer Table.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">or</span> <span class="nb">eax</span><span class="p">,</span> <span class="nv">PAGE_PRESENT</span> <span class="o">|</span> <span class="nv">PAGE_WRITE</span> <span class="c1">; OR EAX with the flags (present flag, writable flag).</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span><span class="p">],</span> <span class="nb">eax</span>                  <span class="c1">; Store the value of EAX as the first PML4E.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="c1">; Build the Page Directory Pointer Table.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">lea</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span> <span class="o">+</span> <span class="mh">0x2000</span><span class="p">]</span>         <span class="c1">; Put the address of the Page Directory in to EAX.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">or</span> <span class="nb">eax</span><span class="p">,</span> <span class="nv">PAGE_PRESENT</span> <span class="o">|</span> <span class="nv">PAGE_WRITE</span> <span class="c1">; OR EAX with the flags (present flag, writable flag).</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span> <span class="o">+</span> <span class="mh">0x1000</span><span class="p">],</span> <span class="nb">eax</span>         <span class="c1">; Store the value of EAX as the first PDPTE.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="c1">; Build the Page Directory.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">lea</span> <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span> <span class="o">+</span> <span class="mh">0x3000</span><span class="p">]</span>          <span class="c1">; Put the address of the Page Table in to EAX.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">or</span> <span class="nb">eax</span><span class="p">,</span> <span class="nv">PAGE_PRESENT</span> <span class="o">|</span> <span class="nv">PAGE_WRITE</span>  <span class="c1">; OR EAX with the flags (present flag, writable flag).</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span> <span class="o">+</span> <span class="mh">0x2000</span><span class="p">],</span> <span class="nb">eax</span>          <span class="c1">; Store to value of EAX as the first PDE.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">di</span>                            <span class="c1">; Save DI for the time being.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">lea</span> <span class="nb">di</span><span class="p">,</span> <span class="p">[</span><span class="nb">di</span> <span class="o">+</span> <span class="mh">0x3000</span><span class="p">]</span>              <span class="c1">; Point DI to the page table.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="nv">PAGE_PRESENT</span> <span class="o">|</span> <span class="nv">PAGE_WRITE</span> <span class="c1">; Move the flags into EAX - and point it to 0x0000.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; Build the Page Table.</span>
</span></span><span class="line"><span class="cl">    <span class="nl">.LoopPageTable:</span>
</span></span><span class="line"><span class="cl">        <span class="nf">mov</span> <span class="p">[</span><span class="nb">es</span><span class="p">:</span><span class="nb">di</span><span class="p">],</span> <span class="nb">eax</span>
</span></span><span class="line"><span class="cl">        <span class="nf">add</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0x1000</span>
</span></span><span class="line"><span class="cl">        <span class="nf">add</span> <span class="nb">di</span><span class="p">,</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">        <span class="nf">cmp</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0x200000</span>               <span class="c1">; If we did all 2MiB, end.</span>
</span></span><span class="line"><span class="cl">        <span class="nf">jb</span> <span class="nv">.LoopPageTable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">di</span>                              <span class="c1">; Restore DI.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span></span></span></code></pre></div>

<h2 id="stage2-pic-asm">stage2/pic.asm</h2>

<p lang="en">The Programmable Interrupt Controller (<strong>PIC</strong>) is one of the most important chips in the x86 architecture. Its function is to manage hardware interrupts and send them to the appropriate system interrupts. This allows the system to respond to devices without the need for polling them all the time. In protected mode and long mode, the Interrupt Requests (<strong>IRQs</strong>) 0-15 are in conflict with the CPU exceptions which reserve the first 32 positions (0-31 or 0x00-0x1F). Thus, prior to switching to the long mode, we have to change the PIC's offsets (a.k.a. <em>remapping the PIC</em>) so that IRQs use non-reserved vectors:</p>
<p lang="el">O Προγραμματιζόμενος Ελεγκτής Διακοπών (Programmable Interrupt Controller, <strong>PIC</strong>) είναι ένα από τα πιο σημαντικά ολοκληρωμένα κυκλώματα στην αρχιτεκτονικη x86. Η λειτούργια του είναι να διαχειρίζεται τις διακοπές υλικού (hardware interrupts) και να τις στέλνει στις κατάλληλες διακοπές συστήματος. Αυτό επιτρέπει στο σύστημα να ανταποκρίνεται στις συσκευές χωρίς την ανάγκη να τις βολιδοσκοπεί περιοδικά (polling) όλη την ώρα. Στην προστατευμένη κατάσταση λειτουργίας (protected mode) και στην μακρά κατάσταση λειτουργίας (long mode), οι αιτήσεις διακοπών (Interrupt Requests, <strong>IRQs</strong>) 0-15 συγκρούονται με τις εξαιρέσεις του επεξεργαστή (CPU exceptions) που δεσμεύουν τις πρώτες 32 θέσεις (0-31 ή 0x00-0x1F). Ως εκ τούτου, πριν τη μετάβαση στην λειτουργία μακράς κατάστασης, πρέπει να μετατοπίσουμε τα IRQs σε μη δεσμευμένες θέσεις στον PIC (αυτή η διαδικασία είναι γνωστή και ως <em>"remapping the PIC"</em>):</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="c1">; PIC (Programmable Interrupt Controller)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">BITS</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Constants----------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="no">PIC1_COMMAND</span><span class="kd">    equ</span> <span class="mh">0x20</span> <span class="c1">; Command port of 1st PIC</span>
</span></span><span class="line"><span class="cl"><span class="no">PIC1_DATA</span><span class="kd">       equ</span> <span class="mh">0x21</span> <span class="c1">; Data port of 1st PIC</span>
</span></span><span class="line"><span class="cl"><span class="no">PIC2_COMMAND</span><span class="kd">    equ</span> <span class="mh">0xA0</span> <span class="c1">; Command port of 2nd PIC</span>
</span></span><span class="line"><span class="cl"><span class="no">PIC2_DATA</span><span class="kd">       equ</span> <span class="mh">0xA1</span> <span class="c1">; Data port of 2nd PIC</span>
</span></span><span class="line"><span class="cl"><span class="no">PIC_EOI</span><span class="kd">         equ</span> <span class="mh">0x20</span> <span class="c1">; EOI (End of interrupt) command (= 0x20)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">ICW1_ICW4</span><span class="kd">       equ</span> <span class="mh">0x01</span> <span class="c1">; Initialization Command Word 4 is needed</span>
</span></span><span class="line"><span class="cl"><span class="no">ICW1_SINGLE</span><span class="kd">     equ</span> <span class="mh">0x02</span> <span class="c1">; Single mode (0: Cascade mode)</span>
</span></span><span class="line"><span class="cl"><span class="no">ICW1_INTERVAL4</span><span class="kd">  equ</span> <span class="mh">0x04</span> <span class="c1">; Call address interval 4 (0: 8)</span>
</span></span><span class="line"><span class="cl"><span class="no">ICW1_LEVEL</span><span class="kd">      equ</span> <span class="mh">0x08</span> <span class="c1">; Level triggered mode (0: Edge mode)</span>
</span></span><span class="line"><span class="cl"><span class="no">ICW1_INIT</span><span class="kd">       equ</span> <span class="mh">0x10</span> <span class="c1">; Initialization - required!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">ICW4_8086</span><span class="kd">       equ</span> <span class="mh">0x01</span> <span class="c1">; 8086/88 mode (0: MCS-80/85 mode)</span>
</span></span><span class="line"><span class="cl"><span class="no">ICW4_AUTO_EOI</span><span class="kd">   equ</span> <span class="mh">0x02</span> <span class="c1">; Auto End Of Interrupt (0: Normal EOI)</span>
</span></span><span class="line"><span class="cl"><span class="no">ICW4_BUF_SLAVE</span><span class="kd">  equ</span> <span class="mh">0x08</span> <span class="c1">; Buffered mode/slave</span>
</span></span><span class="line"><span class="cl"><span class="no">ICW4_BUF_MASTER</span><span class="kd"> equ</span> <span class="mh">0x0C</span> <span class="c1">; Buffered mode/master</span>
</span></span><span class="line"><span class="cl"><span class="no">ICW4_SFNM</span><span class="kd">       equ</span> <span class="mh">0x10</span> <span class="c1">; Special Fully Nested Mode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Code---------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nl">Remap_PIC:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;***************************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; In protected / long mode, the IRQs 0-15 conflict with the CPU exceptions  ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; (which are reserved up until 0x1F). It is thus recommended to change the  ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; PIC&#39;s offsets (remapping the PIC) so that IRQs use non-reserved  vectors. ; </span>
</span></span><span class="line"><span class="cl"><span class="c1">; A common choice is to move them to the beginning of the available range:  ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; IRQs 0..15 -&gt; INT 0x20..0x2F (30..47). For that, we need to set the 1st   ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; PIC&#39;s offset to 0x20 (32) and the 2nd&#39;s to 0x28 (40).                     ;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">;***************************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">push</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; Disable IRQs</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="c1">; Out 0xFF to 0xA1 and 0x21 to mask/disable all IRQs.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC1_DATA</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC2_DATA</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">nop</span>
</span></span><span class="line"><span class="cl">    <span class="nf">nop</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">; Remap PIC</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="nv">ICW1_INIT</span> <span class="o">|</span> <span class="nv">ICW1_ICW4</span> <span class="c1">; ICW1: Send initialization command (= 0x11) to both PICs </span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC1_COMMAND</span><span class="p">,</span> <span class="nb">al</span>    
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC2_COMMAND</span><span class="p">,</span> <span class="nb">al</span>     
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0x20</span>       <span class="c1">; ICW2: Set vector offset of 1st PIC to 0x20 (i.e. IRQ0 =&gt; INT 32) </span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC1_DATA</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0x28</span>       <span class="c1">; ICW2: Set vector offset of 2nd PIC to 0x28 (i.e. IRQ8 =&gt; INT 40)    </span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC2_DATA</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mi">4</span>          <span class="c1">; ICW3: tell 1st PIC that there is a 2nd PIC at IRQ2 (= 00000100)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC1_DATA</span><span class="p">,</span> <span class="nb">al</span>       
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mi">2</span>          <span class="c1">; ICW3: tell 2nd PIC its &#34;cascade&#34; identity (= 00000010) </span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC2_DATA</span><span class="p">,</span> <span class="nb">al</span>        
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="nv">ICW4_8086</span>  <span class="c1">; ICW4: Set mode to 8086/88 mode</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC1_DATA</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC2_DATA</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0xFF</span>       <span class="c1">; OCW1: We mask all interrupts (until we set a proper IDT in Kernel)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC1_DATA</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">    <span class="nf">out</span> <span class="nv">PIC2_DATA</span><span class="p">,</span> <span class="nb">al</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span></span></span></code></pre></div>

<h2 id="stage2-longmode-asm">stage2/longmode.asm</h2>

<p lang="en">Here is the code for checking if the long mode is supported and the code for entering the long mode:</p>
<p lang="el">Εδώ βρίσκεται ο κώδικας που έχει να κάνει με τον έλεγχο υποστήριξης και τη μετάβαση στην λειτουργία μακράς κατάστασης (long mode):</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="k">BITS</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Code------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nl">Is_longmode_supported:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;********************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Check if Long mode is supported                                    ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;--------------------------------------------------------------------;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Returns: eax = 0 if Long mode is NOT supported, else non-zero.     ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;********************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0x80000000</span> <span class="c1">; Test if extended processor info in available.  </span>
</span></span><span class="line"><span class="cl">    <span class="k">cpu</span><span class="nv">id</span>                
</span></span><span class="line"><span class="cl">    <span class="nf">cmp</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0x80000001</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">jb</span> <span class="nv">.not_supported</span>     
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0x80000001</span> <span class="c1">; After calling CPUID with EAX = 0x80000001, </span>
</span></span><span class="line"><span class="cl">    <span class="k">cpu</span><span class="nv">id</span>               <span class="c1">; all AMD64 compliant processors have the longmode-capable-bit</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span> <span class="nb">edx</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">29</span><span class="p">)</span> <span class="c1">; (bit 29) turned on in the EDX (extended feature flags).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">jz</span> <span class="nv">.not_supported</span>   <span class="c1">; If it&#39;s not set, there is no long mode.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="nl">.not_supported:</span>
</span></span><span class="line"><span class="cl">      <span class="nf">xor</span> <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>
</span></span><span class="line"><span class="cl">      <span class="nf">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">Enter_long_mode:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;********************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Enter long mode                                                    ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;********************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edi</span><span class="p">,</span> <span class="nv">PAGING_DATA</span><span class="c1">; Point edi at the PAGING_DATA.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mb">10100000b</span>  <span class="c1">; Set the PAE and PGE bit.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">cr4</span><span class="p">,</span> <span class="nb">eax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="nb">edi</span>        <span class="c1">; Point CR3 at the PML4.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">cr3</span><span class="p">,</span> <span class="nb">edx</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mh">0xC0000080</span> <span class="c1">; Read from the EFER MSR. </span>
</span></span><span class="line"><span class="cl">    <span class="nf">rdmsr</span>    
</span></span><span class="line"><span class="cl">    <span class="nf">or</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0x00000100</span>  <span class="c1">; Set the LME bit.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">wrmsr</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ebx</span><span class="p">,</span> <span class="nb">cr0</span>        <span class="c1">; Activate long mode</span>
</span></span><span class="line"><span class="cl">    <span class="nf">or</span> <span class="nb">ebx</span><span class="p">,</span> <span class="mh">0x80000001</span>  <span class="c1">; by enabling paging and protection simultaneously.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">cr0</span><span class="p">,</span> <span class="nb">ebx</span>                    
</span></span><span class="line"><span class="cl">    <span class="nf">lgdt</span> <span class="p">[</span><span class="nv">GDT.Pointer</span><span class="p">]</span>  <span class="c1">; Load GDT.Pointer.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">jmp</span> <span class="nv">CODE_SEG</span><span class="p">:</span><span class="nv">Kernel</span> <span class="c1">; Load CS with 64 bit segment and flush the instruction cache.</span></span></span></code></pre></div>

<h2 id="kernel-kernel-asm">kernel/kernel.asm</h2>

<p lang="en">Here is some dummy code that write a message directly into the video RAM, just to test if our bootloader is functional:</p>
<p lang="el">Εδώ έχουμε έναν απλό κώδικα, ο οποίος γράφει έναν μήνυμα απευθείας στην περιοχή της μνήμης των γραφικών, απλά για να δούμε αν ο εκκινητή μας είναι λειτουργικός:</p>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="line"><span class="cl"><span class="k">BITS</span> <span class="mi">64</span>  <span class="c1">; We have entered the long mode! :)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;---Define----------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="cp">%define DATA_SEG    0x0010
</span></span></span><span class="line"><span class="cl"><span class="cp">%define VRAM       0xB8000  
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">;---Code------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nl">Kernel:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;********************************************************************;</span>
</span></span><span class="line"><span class="cl"><span class="c1">; Just some dummy code for now                                       ;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;********************************************************************;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">; Set all segments registers to DATA_SEG</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ax</span><span class="p">,</span> <span class="nv">DATA_SEG</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ds</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">es</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">fs</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">gs</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">ss</span><span class="p">,</span> <span class="nb">ax</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">; Set EDI to point to Video RAM (0xB8000)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">edi</span><span class="p">,</span> <span class="nv">VRAM</span>    
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">; Print &#34;Hello World!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mh">0x1F6C1F6C1F651F48</span>    
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="p">[</span><span class="nb">edi</span><span class="p">],</span> <span class="nb">rax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mh">0x1F6F1F571F201F6F</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="p">[</span><span class="nb">edi</span> <span class="o">+</span> <span class="mi">8</span><span class="p">],</span> <span class="nb">rax</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="mh">0x1F211F641F6C1F72</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="p">[</span><span class="nb">edi</span> <span class="o">+</span> <span class="mi">16</span><span class="p">],</span> <span class="nb">rax</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="nl">.halt:</span> <span class="nf">hlt</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">jmp</span> <span class="nv">.halt</span> <span class="c1">; Infinite loop.</span></span></span></code></pre></div>

<h1 id="runningcode"><span lang="en">Running our code</span><span lang="el">Εκτέλεση του κώδικά μας</span></h1>

<p lang="en">We can test our code very easily using an emulator like <a href="https://en.wikipedia.org/wiki/QEMU" target="_blank">QEMU</a>:</p>
<p lang="el">Μπορούμε να δοκιμάσουμε τον κώδικά μας πολύ εύκολα, χρησιμοποιώντας έναν εξομοιωτή όπως ο <a href="https://en.wikipedia.org/wiki/QEMU" target="_blank">QEMU</a>:</p>

<div class="bg-black"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> make
</span></span><span class="line"><span class="cl"><span class="gp">$</span> qemu-system-x86_64 -drive <span class="nv">format</span><span class="o">=</span>raw,file<span class="o">=</span>os.bin
</span></span></code></pre></div></div>

<p><img class="centered" src="/images/os_stage2.jpg" alt="Running Bootloader" title="Running Bootloader"/></p>

<h1 id="fullcode"><span lang="en">Full code</span><span lang="el">Πλήρης κώδικας</span></h1>

<p lang="en">You can download the full code from here: <a href="https://github.com/Alamot/code-snippets/tree/master/os/part2" target="_blank">bootloader code</a></p>
<p lang="el">Μπορείτε να κατεβάσετε τον πλήρη κώδικα απο εδώ: <a href="https://github.com/Alamot/code-snippets/tree/master/os/part2" target="_blank">κώδικας εκκινητή</a></p> 

<h1 id="reference"><span lang="en">References</span><span lang="el">Αναφορές</span></h1>

<ul>
<li><a href="https://wiki.osdev.org/" target="_blank">https://wiki.osdev.org/</a></li>
</ul>

        </div>

        <aside>
          <div class="p-share centered">
            <a href="https://www.buymeacoffee.com/alamot" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-coffee"></i></a>
            <a href="http://www.facebook.com/sharer.php?src=bm&u=https%3a%2f%2falamot.github.io%2fos_stage2%2f&t=How%20to%20write%20your%20own%20Operating%20System%20%28x86_64%29%3a%20Bootloader%2c%202nd%20Stage%20%28long%20mode%29" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-facebook"></i></a>
            <a lang="en" href="http://twitter.com/intent/tweet?url=https%3a%2f%2falamot.github.io%2fos_stage2%2f&text=How%20to%20write%20your%20own%20Operating%20System%20%28x86_64%29%3a%20Bootloader%2c%202nd%20Stage%20%28long%20mode%29&tw_p=tweetbutton" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-twitter"></i></a>
            <a lang="el" href="http://twitter.com/intent/tweet?url=https%3a%2f%2falamot.github.io%2fos_stage2%2f&text=%ce%a0%cf%89%cf%82%20%ce%bd%ce%b1%20%ce%b3%cf%81%ce%ac%cf%88%ce%b5%cf%84%ce%b5%20%cf%84%ce%bf%20%ce%b4%ce%b9%ce%ba%cf%8c%20%cf%83%ce%b1%cf%82%20%ce%9b%ce%b5%ce%b9%cf%84%ce%bf%cf%85%cf%81%ce%b3%ce%b9%ce%ba%cf%8c%20%ce%a3%cf%8d%cf%83%cf%84%ce%b7%ce%bc%ce%b1%20%28x86_64%29%3a%20%ce%95%ce%ba%ce%ba%ce%b9%ce%bd%ce%b7%cf%84%ce%ae%cf%82%2c%202o%20%ce%a3%cf%84%ce%ac%ce%b4%ce%b9%ce%bf%20%28%ce%bc%ce%b1%ce%ba%cf%81%ce%ac%20%ce%ba%ce%b1%cf%84%ce%ac%cf%83%cf%84%ce%b1%cf%83%ce%b7%29&tw_p=tweetbutton" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-twitter"></i></a>
            <a lang="en" href="http://pinterest.com/pin/create/link/?url==https%3a%2f%2falamot.github.io%2fos_stage2%2f&description=How%20to%20write%20your%20own%20Operating%20System%20%28x86_64%29%3a%20Bootloader%2c%202nd%20Stage%20%28long%20mode%29&media=https://alamot.github.io/images/os2.jpg" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-pinterest-p"></i></a>
            <a lang="el" href="http://pinterest.com/pin/create/link/?url==https%3a%2f%2falamot.github.io%2fos_stage2%2f&description=%ce%a0%cf%89%cf%82%20%ce%bd%ce%b1%20%ce%b3%cf%81%ce%ac%cf%88%ce%b5%cf%84%ce%b5%20%cf%84%ce%bf%20%ce%b4%ce%b9%ce%ba%cf%8c%20%cf%83%ce%b1%cf%82%20%ce%9b%ce%b5%ce%b9%cf%84%ce%bf%cf%85%cf%81%ce%b3%ce%b9%ce%ba%cf%8c%20%ce%a3%cf%8d%cf%83%cf%84%ce%b7%ce%bc%ce%b1%20%28x86_64%29%3a%20%ce%95%ce%ba%ce%ba%ce%b9%ce%bd%ce%b7%cf%84%ce%ae%cf%82%2c%202o%20%ce%a3%cf%84%ce%ac%ce%b4%ce%b9%ce%bf%20%28%ce%bc%ce%b1%ce%ba%cf%81%ce%ac%20%ce%ba%ce%b1%cf%84%ce%ac%cf%83%cf%84%ce%b1%cf%83%ce%b7%29&media=https://alamot.github.io/images/os2.jpg" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-pinterest-p"></i></a>
          </div>
        </aside>
      </article>
      
      <section id="posts-section">
        <header lang="en"><h3>See also...</h3></header>
        <header lang="el"><h3>Δείτε επίσης...</h3></header>
        <div>
          
          
          
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/os_stage1/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/os1.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to write your own Operating System (x86_64): Bootloader, 1st Stage</h3>
      <h3 class="title" lang="el">Πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64): Εκκινητής, 1o Στάδιο</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">10 Apr 2022</time>
      <time lang="el">10 Απρ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/os_tasking/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/os4.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to write your own Operating System (x86_64): Multitasking</h3>
      <h3 class="title" lang="el">Πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64): Πολυδιεργασία</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">23 Apr 2022</time>
      <time lang="el">23 Απρ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/os_isr/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/os3.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to write your own Operating System (x86_64): Interrupts</h3>
      <h3 class="title" lang="el">Πως να γράψετε το δικό σας Λειτουργικό Σύστημα (x86_64): Διακοπές</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">21 Apr 2022</time>
      <time lang="el">21 Απρ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
          
           
           
           
          
           
           
           
          
           
           
           
          
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/oracle/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/oracle.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Ask and you shall receive</h3>
      <h3 class="title" lang="el">Ζήτα και θα λάβεις</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">04 May 2019</time>
      <time lang="el">04 Μαϊ 2019</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/kivy_popup/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/kivy.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to build a responsive popup window with scrolling capability in Kivy</h3>
      <h3 class="title" lang="el">Πως να φτιάξετε ένα ευέλικτο αναδυόμενο παράθυρο με δυνατότητα κύλισης στην Kivy</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">19 Feb 2014</time>
      <time lang="el">19 Φεβ 2014</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/test_encodings/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/encodings.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to determine the character encoding of a text file</h3>
      <h3 class="title" lang="el">Πως να αναγνωρίσετε την κωδικοποίηση χαρακτήρων ενός αρχείου κειμένου</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">21 Oct 2016</time>
      <time lang="el">21 Οκτ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/shutdown_manager_transparent/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/transparent_shutdown.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Creation of a transparent shutdown GUI using Gtk and Cairo in Python</h3>
      <h3 class="title" lang="el">Δημιουργία μιας διαφανούς γραφικής διεπαφής κλεισίματος με τη χρήση Gtk και Cairo σε Python</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">19 Sep 2016</time>
      <time lang="el">19 Σεπ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/shutdown_manager_plain/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/shutdown_button.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Creation of a shutdown GUI using Gtk in Python</h3>
      <h3 class="title" lang="el">Δημιουργία μιας γραφικής διεπαφής κλεισίματος με τη χρήση Gtk σε Python</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">21 Jul 2016</time>
      <time lang="el">21 Ιουλ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/winrm_shell/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/winrm.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">WinRM shell (a.k.a. PowerShell Remoting) with file upload capability</h3>
      <h3 class="title" lang="el">WinRM κέλυφος (PowerShell Remoting) με δυνατότητα ανεβάσματος αρχείων</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">09 Apr 2018</time>
      <time lang="el">09 Απρ 2018</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/path_traversal_archiver/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/path.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Path-traversal archiver</h3>
      <h3 class="title" lang="el">Αρχειοθέτης με διάσχιση διαδρομής</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">14 May 2019</time>
      <time lang="el">14 Μαϊ 2019</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/web_file_browser/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/web_file_browser.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to write your own Web File Browser</h3>
      <h3 class="title" lang="el">Πως να γράψετε τον δικό σας Διαδικτυακό Περιηγητή Αρχείων</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">11 May 2022</time>
      <time lang="el">11 Μαϊ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/sutherland_hodgman_algorithm/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/Sutherland_Hodgman_3D.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">3D visualization of Sutherland-Hodgman algorithm (polygon clipping)</h3>
      <h3 class="title" lang="el">Τρισδιάστατη οπτικοποίηση του αλγορίθμου Sutherland-Hodgman (αποκοπή πολυγώνων)</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">25 Apr 2016</time>
      <time lang="el">25 Απρ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/epub_cover/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/openbook.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to read the cover image from an EPUB file in Python</h3>
      <h3 class="title" lang="el">Πως να διαβάσετε την εικόνα εξωφύλλου από ένα αρχείο EPUB σε Python</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">10 May 2020</time>
      <time lang="el">10 Μαϊ 2020</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/fast_commit_push/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/binary_flow.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">Git &amp; Mercurial: How to commit-push fast and easily</h3>
      <h3 class="title" lang="el">Git &amp; Mercurial: Πως να κάνετε commit-push γρήγορα και εύκολα</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">17 Oct 2016</time>
      <time lang="el">17 Οκτ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/get_outlook_rules/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/flying_mail.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to collect Outlook rules using Powershell</h3>
      <h3 class="title" lang="el">Πως να συλλέξετε τους κανόνες του Outlook χρησιμοποιώντας Powershell</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">20 May 2022</time>
      <time lang="el">20 Μαϊ 2022</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/mssql_shell/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/dbs.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">MSSQL shell with file upload capability</h3>
      <h3 class="title" lang="el">MSSQL κέλυφος με δυνατότητα ανεβάσματος αρχείων</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">13 Apr 2018</time>
      <time lang="el">13 Απρ 2018</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
            <article class="li col-sm-6 col-md-4">
  <a href="https://alamot.github.io/nl80211/" class="clearfix">
    <div class="cell">
      <div class="image" style="background-image: url(https://alamot.github.io/images/wifi-sign.jpg);"></div>
    </div>
    <footer>
      <h3 class="title" lang="en">How to get info for the wireless interface using nl80211 in C</h3>
      <h3 class="title" lang="el">Πως να λάβετε πληροφορίες για την ασύρματη διεπαφή χρησιμοποιώντας την nl80211 στη C</h3>
      <i class="fa fa-calendar"></i>
      <time lang="en">09 Oct 2016</time>
      <time lang="el">09 Οκτ 2016</time>
    </footer>
  </a>
</article>

           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
           
           
           
           
          
        </div>
      </section>
      
    </div>
   </div> 
  </div>


<footer class="l-footer">
<span class="copyleft">&copy;</span>
<span lang="en">&nbsp; Antonios Tsolis &nbsp; </span>
<span lang="el">&nbsp; Αντώνιος Τσώλης &nbsp; </span>
<script>
  function email(starting,server,firstname,lastname,subject,body,closing) {
    document.write(starting); document.write(lastname); document.write("." + firstname); document.write("@" + server);if (Boolean(subject)) { document.write("?subject=" + subject + "&body=" + body); }
    document.write(closing); }
  email("<a class='mymail' href='mailto:", "gmail.com", "antonios", "tsolis", "", "","' target='_blank'><i class='fa fa-envelope-o' aria-hidden='true'></i></a>");
</script>
</footer>
<script async src="https://alamot.github.io/js/jq-btsp-lunr.min.js" onload="init()"></script>
<script>
short_months = {
  "en": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
  "el": ["Ιαν", "Φεβ", "Μαρ", "Απρ", "Μαϊ", "Ιουν", "Ιουλ", "Αυγ", "Σεπ", "Οκτ", "Νοε", "Δεκ"]
}
function init () {
$(document).ready(function(){
  $("#lang-selector>ul>li>a").click(function(){
    var langid = this.id;
    var selText = this.text;
    document.getElementById('mainbody').setAttribute('class', langid);
    document.getElementById('mainbody').setAttribute('lang', langid);
    localStorage.setItem('language', langid);
    $("#lang-selector>a").html(selText+' <i class="fa fa-caret-down" aria-hidden="true"></i>');
  });

  $("#TableOfContents a, #content-selector a").on('click', function(e) {
    var hash = this.hash;
    if (hash) {
      e.preventDefault();
      $('html, body').animate({scrollTop: $(hash).offset().top}, 1300, function(){
        window.location.hash = hash;
      });
    }  
  });

  
});}
</script>
<script>
(function(a){var b=function(b,h,n){function d(a){if(f.body)return a();setTimeout(function(){d(a)})}function k(){c.addEventListener&&c.removeEventListener("load",k);c.media=n||"all"}var f=a.document,c=f.createElement("link"),g;if(h)g=h;else{var e=(f.body||f.getElementsByTagName("head")[0]).childNodes;g=e[e.length-1]}var m=f.styleSheets;c.rel="stylesheet";c.href=b;c.media="only x";d(function(){g.parentNode.insertBefore(c,h?g:g.nextSibling)});var l=function(a){for(var b=c.href,d=m.length;d--;)if(m[d].href===
b)return a();setTimeout(function(){l(a)})};c.addEventListener&&c.addEventListener("load",k);c.onloadcssdefined=l;l(k);return c};"undefined"!==typeof exports?exports.loadCSS=b:a.loadCSS=b})("undefined"!==typeof global?global:this);
(function(a){if(a.loadCSS){var b=loadCSS.relpreload={};b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(h){return!1}};b.poly=function(){for(var b=a.document.getElementsByTagName("link"),e=0;e<b.length;e++){var d=b[e];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d),d.rel=null)}};if(!b.support()){b.poly();var e=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){a.clearInterval(e)});a.attachEvent&&
a.attachEvent("onload",function(){a.clearInterval(e)})}}})(this);
</script>
</body>
</html>

